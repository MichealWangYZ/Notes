空间平移群是李群，它在$\mathcal{H}_{1\text{d}}$上的幺正表示$\hat{Q}(a)$满足以下特征：
\begin{itemize}
    \item $\hat{Q}(a) \ket{x} = \ket{x+a}$；
    \item $\hat{Q}(a+b) = \hat{Q}(a) \hat{Q}(b)$；
\end{itemize}
$\hat{Q}(a)$是幺正的意味着$\ii \dd{\hat{Q}} / \dd{a}$是厄米的，因此对应一个可观察量。
$\hat{Q}(a+b)=\hat{Q}(a) \hat{Q}(b)$则意味着$\dd{\hat{Q}} / \dd{a}$与群参数$a$无关，即变换是均匀的。
于是设
\begin{equation}
    \hat{Q}(\dd{x}) = \hat{I} + \frac{1}{\ii} \dd{x} \hat{p},
\end{equation}
其中$\hat{p}$是一个不显含任何参量的厄米算符。容易看出它具有动量量纲。
注意到
\[
    \begin{split}
        \hat{x} \hat{Q}(\dd{x'}) \ket{x'} = \hat{x} \ket{x' + \dd{x'}} = (x' + \dd{x'}) \ket{x' + \dd{x'}}, \\
        \hat{Q}(\dd{x'}) \hat{x} \ket{x'} = \hat{Q}(\dd{x'}) x' \ket{x'} = x' \hat{Q}(\dd{x'}) \ket{x'} = x' \ket{x' + \dd{x'}},
    \end{split}
\]
就有
\[
    [\hat{x}, \hat{Q}(\dd{x'})] \ket{x'} = \dd{x'} \ket{x' + \dd{x'}} \approx \dd{x'} \ket{x'}.
\]
考虑到$\ket{x'}$的任意性，我们得到
\[
    [\hat{x}, \hat{Q}(\dd{x'})] = \left[\hat{x}, \hat{I} + \frac{1}{\ii} \dd{x} \hat{p}\right] = \hat{I},
\]
从而
\begin{equation}
    [\hat{x}, \hat{p}] = \ii . 
    \label{eq:x-p-commutator-1d}   
\end{equation}
对易关系\eqref{eq:x-p-commutator-1d}完全确定了$\hat{x}$和$\hat{p}$的李代数结构。

下面推导$\hat{x}, \hat{p}$和任意物理量的对易关系。
设能够将物理量$\hat{F}$展开为$\hat{x}, \hat{p}$的多项式$\hat{F} = F(\hat{x}, \hat{p})$。
对其中的每一项，都可以使用对易关系\eqref{eq:x-p-commutator-1d}把$\hat{x}$挪到最前面而把$\hat{p}$挪到后面，
因此展开式最后就可以写成若干个$a \hat{x}^m \hat{p}^n$形式的项之和。
现在分析其中的一项：
\[
    [\hat{x}, \hat{x}^m \hat{p}^n] = \hat{x}^m [\hat{x}, \hat{p}^n] + [\hat{x}, \hat{x}^m] \hat{p}^n = \hat{x}^m [\hat{x}, \hat{p}^n],
\]
而
\[
    [\hat{x}, \hat{p}^n] = [\hat{x}, \hat{p} \hat{p}^{n-1}] = 
    \hat{p} [\hat{x}, \hat{p}^{n-1}] + [\hat{x}, \hat{p}] \hat{p}^{n-1} = \hat{p} [\hat{x}, \hat{p}^{n-1}] + \ii \hat{p}^{n-1}
\]
于是递推得到
\[
    [\hat{x}, \hat{p}^n] = \ii n \hat{p}^{n-1},
\]
因此
\[
    [\hat{x}, \hat{x}^m \hat{p}^n] = \ii n \hat{x}^m \hat{p}^{n-1}.
\]
这样就可以写出
\begin{equation}
    [\hat{x}, \hat{F}(\hat{x}, \hat{p})] = \ii \pdv{p} \hat{F}(\hat{x}, \hat{p}),
\end{equation}
在作用偏微分符号之前需要先把$F$中的每一项都变形成$\hat{x}$在前$\hat{p}$在后的形式。
使用同样的方法还可以导出
\begin{equation}
    [\hat{p}, \hat{F}(\hat{x}, \hat{p})] = - \ii \pdv{x} \hat{F}(\hat{x}, \hat{p}),
\end{equation}
同样，作用偏微分符号之前需要先把$F$中的每一项都变形成$\hat{x}$在前$\hat{p}$在后的形式。

在海森堡绘景下
\[
    \dv{\hat{A}}{t} = \frac{1}{\ii} [\hat{A}, H] + \pdv{\hat{A}}{t},
\]
于是
\[
    \dv{\hat{x}}{t} = \frac{1}{\ii} [\hat{x}, H] = \pdv{p} \hat{H}(\hat{x}, \hat{p}), \quad
    \dv{\hat{p}}{t} = \frac{1}{\ii} [\hat{p}, H] = -\pdv{x} \hat{H}(\hat{x}, \hat{p})
\]
当$\hbar \to 0$时，上式仍然成立，而此时$\hat{x}$和$\hat{p}$已经是对易的了，因此它们退化为了可以直接使用实数表示的情况，我们也就过渡到了经典力学。
这就是要求$\hat{p}$具有动量量纲的原因——它的确是经典动量的推广。

三维空间平移群在态空间上的幺正表示为$\hat{Q}(\vb*{a})$，同样还是满足与一维情况类似的几个条件：
\begin{itemize}
    \item 平移将位置算符的一个本征态变换为另一个：
    \begin{equation}
        \hat{Q}(\vb*{a}) \ket{\vb*{x}} = \ket{\vb*{x} + \vb*{a}}.
    \end{equation}
    \item 一次完成平移和多次完成是一样的：
    \begin{equation}
        \hat{Q}(\vb*{a}) \hat{Q}(\vb*{b}) = \hat{Q}(\vb*{a} + \vb*{b}).
        \label{eq:movement-plusable}
    \end{equation}
\end{itemize}
同样，\eqref{eq:movement-plusable}意味着生成元不显含群参数。
三维空间平移群本身是三维的，也就是说有三个生成元。不妨设这三个生成元是满足
\begin{equation}
    \begin{split}
        \hat{Q}(\vb*{e}_1 \dd{x_1}) = \hat{I} + \frac{1}{\ii \hbar} \hat{p}_1, \\
        \hat{Q}(\vb*{e}_2 \dd{x_2}) = \hat{I} + \frac{1}{\ii \hbar} \hat{p}_2, \\
        \hat{Q}(\vb*{e}_3 \dd{x_3}) = \hat{I} + \frac{1}{\ii \hbar} \hat{p}_3
    \end{split} 
\end{equation}
的不显含群参量的算符。显然它们是厄米的。
我们可以重复一维的操作步骤来获得三维空间平移群的生成元及其对易关系。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

记态密度为 % TODO:能级实际上总是离散的
\begin{equation}
    d = \dv{\Omega}{E}.
\end{equation}
由于\eqref{eq:total-energy}，我们有
\[
    \dd{E_s} \dd{E_r} = \dd{E_s} (\dd{E} - \dd{E_s}) = \dd{E_s} \dd{E},
\]
于是
\[
    \begin{aligned}
        d_T (E_T) &= \int_{E_s + E_r = E_T} \dd{E_s} \dd{E_r} d_r (E_r) d_s (E_s) \\
        &= \int \dd{E_s} \dd{E} d_r (E_T - E_s) d_s (E_s),
    \end{aligned}
\]
从而
\[
    d_T (E_T) = \int \dd{E_s} d_r (E_T - E_s) d_s (E_s).
\]
由于热库远大于系统，$d_s$只有在$E_s$远小于$E_T$时才有比较大的值，因此
\begin{equation}
    d_T (E_T) = d_r (E_T).
\end{equation}
% 这个公式有什么用吗？

我们来分析系统取特定能量的概率。%
\footnote{请注意由于系统可以和热库有相互作用，系统的能量并不是固定的。当然，到平衡态时，系统的能量的期望是固定的。平衡态系统的能量在其期望附加有上下涨落。}%
我们称系统处于某个能量上的所有态的总和为\textbf{能级}。
首先假定系统的能级没有简并，或者各个能级的简并情况是相同的（也就是说，每个能级上的简并数相同）。%
\footnote{等价地说就是，系统的态空间可以写成能量空间直积上别的某些自由度。另一种等价的说法是，系统的哈密顿算符$\hat{H}$和别的某几个算符可以构成系统的一组CSCO。}%
由于系统和热库总能量恒定，我们有
\[
    P(E_s) \propto d_r (E_T - E_s),
\]
从而
\[
    \frac{P(E_s)}{P(E_{s'})} = \frac{d_r (E_T - E_s)}{d_r (E_T - E_{s'})}.
\]
等式右边是一个关于$E_T, E_s, E_{s'}$的表达式。因此我们成功地确定了一个事实：$E_s$的变动导致的概率的变动仅仅依赖于$E_s, E_{s'}$和$E_T$。
但实际上，$E_T$并不会改变概率比值。只要满足热库远大于系统，将环境中的什么部分算作热库是完全任意的，因此完全可以将环境中和原热库和系统没有相互作用的一部分算作热库，这增大了$E_T$，却对系统的行为没有任何影响。这表明我们有
\[
    \frac{P(E_s)}{P(E_{s'})} \propto f(E_s, E_{s'}).
\]
最后，注意到系统的能量可以整体地加上一个常数而不影响其行为%
\footnote{我们就是在这里用到了系统无简并或者各个能级的简并情况相同这一假设。如果系统不同能级上的简并数不同，那当我们整体地将能量加上一个常数时还需要调整对应能级的简并数才能够让系统行为保持不变。
例如，设能级$E_0$上的简并数为$n_1$，$E_0 + \Delta E$上的简并数为$n_2$，现在如果将能量整体地加上常数$\Delta E$，那需要重新规定能级$E_0 + \Delta E$上的简并数为$n_1$。}%
，因此上式右边只应该关于$E_s$和$E_{s'}$的差值，从而
\[
    \frac{P(E_s)}{P(E_{s'})} \propto f(E_s - E_{s'}).
\]
满足这个关系的唯一可能就是
\begin{equation}
    P(E_s) \propto \ee^{- \beta E_s}.
    \label{eq:gibbs-distribution-without-degenerate}
\end{equation}
这就是所谓的\textbf{玻尔兹曼分布}或者\textbf{吉布斯分布}。与环境交换物质能量的系统在平衡时一定会落在这个分布上。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55

进一步，假定系统能级无简并。这样可以很容易地对\eqref{eq:gibbs-distribution-without-degenerate}做归一化，就有
\begin{equation}
    P(E_s) = \frac{1}{Z} \ee^{ - \beta E_s},
    \label{eq:distribution-of-energy-without-degenerate}
\end{equation}
其中
\begin{equation}
    Z = \sum_{E_s} \ee^{ - \beta E_s}
    \label{eq:partition-function-without-degenerate}
\end{equation}
就是在引入未归一化的密度算符时提到的配分函数。相应的，密度算符为
\begin{equation}
    \hat{\rho} = \sum_{E_s} P(E_s) \dyad{E_s} = \sum_{E_s} \ee^{-\beta E_s} \dyad{E_s} = \sum_n \ee^{-\beta E_n} \dyad{n}.
    \label{eq:density-operator-without-degenerate}
\end{equation}
其中$n$是能量本征态的标记，$E_n$指的是$\ket{n}$的本征值。

如果系统的能级有简并，这说明能量$\hat{H}$不足以成为描述系统的CSCO；还需要一些其它的算符来完整地描述系统。我们把它们打包设为$\hat{A}$。
于是，可以先在哈密顿量中引入微小的关于$\hat{A}$的扰动，即
\[
    \hat{H}' = \hat{H} + \lambda \hat{H}_1 (\hat{A}), \quad \lambda \ll 1,
\]
让简并消失，但与此同时不对态空间产生很大影响，此时\eqref{eq:density-operator-without-degenerate}就适用了。现在让$\lambda$趋于零，我们注意到\eqref{eq:density-operator-without-degenerate}中关于$E_s$的所有表达式在$\lambda$取0时会出现突变，因为此时本来能够分开的$E_s$突然变得不能分开了，但是关于$\ket{n}$的表达式的变化却是可微的。
因此有简并时的密度算符为%
\footnote{设算符$\hat{A}$可被谱展开为
\[
    \hat{A} = \sum_i A_i \dyad{i},
\]
则可以验证，一个解析函数作用在$\hat{A}$上的结果为
\[
    f(\hat{A}) = \sum_i f(A_i) \dyad{i}.
\]
因此即使函数$f$的性质不那么好，我们也规定上式成立。
}
\begin{equation}
    \hat{\rho} = \sum_n \ee^{-\beta E_n} \dyad{n} = \ee^{-\beta \hat{H}}.
    \label{eq:gibbs-density-operator}
\end{equation}
相应的，可以读出
\begin{equation}
    P(E_i) = \frac{1}{Z} \sum_{E_n = E_i} \mel{n}{\hat{\rho}}{n} = \frac{1}{Z} g_i \ee^{-\beta E_i},
\end{equation}
其中$E_i$指的是第$i$个能级的能量，$g_i$指的是第$i$个能级的简并度。相应的配分函数为
\begin{equation}
    Z = \sum_i g_i \ee^{- \beta E_i} = \sum_\text{eigenstate $\ket{n}$} \ee^{- \beta E_n} .
\end{equation}
第二个等号表示对所有能量本征态求和，当然，此时没有必要使用简并数因子，因为所有态，无论简并不简并，都已被考虑了。

设$\hat{H}_0$是一个不显含时间的算符，我们将$\hat{H}^H$做如下的分解：
\begin{equation}
    \hat{H}^H = \hat{H}_0 + \hat{H}^H_i,
\end{equation}
并且令$\hat{A}^I$的演化方程为
\begin{equation}
    \dv{\hat{A}^I}{t} = \frac{1}{\ii \hbar} \comm*{\hat{A}^I}{\hat{H}_0},
\end{equation}
从而我们有
\begin{equation}
    \hat{A}^I (t) = \exp \left( \frac{\ii}{\hbar} \hat{H}_0 t \right) \hat{A}^I (0) \exp \left( - \frac{\ii}{\hbar} \hat{H}_0 t \right).
\end{equation}
与$\hat{A}^H$相对比，我们有
\[
    \hat{A}^I (t) = \exp\left(\frac{\ii}{\hbar}\hat{H}_0 t\right) T \exp \left( \frac{\ii}{\hbar} \int_0^t \dd{t} \hat{H}^H(t) \right)^\dagger \hat{A}^H(0) T \exp \left( \frac{\ii}{\hbar} \int_0^t \dd{t} \hat{H}^H(t) \right) \exp\left(-\frac{\ii}{\hbar}\hat{H}_0 t\right).
\]
与\eqref{eq:picture-trans}相比较有
\[
    \hat{Q} = T \exp \left( \frac{\ii}{\hbar} \int_{t_0}^t \dd{t} \hat{H}^H_i (t) \right),
\]
这样
\[
    \ket{\psi^H} = \hat{Q} \ket{\psi^I (t)} = T \exp \left( \frac{\ii}{\hbar} \int_{t_0}^t \dd{t} \hat{H}^H_i (t) \right) \ket{\psi^I (t)}.
\]
于是我们发现
\[
    \ket{\psi^I (0)} = \ket{\psi^H},
\]
且与推导薛定谔绘景类似地可以推导出
\[
    \ii \hbar \dv{t} \ket{\psi^I (t)} = T \exp \left( \frac{\ii}{\hbar} \int_{t_0}^t \dd{t} \hat{H}^H_i (t) \right)^\dagger \hat{H}_i^H (t) T \exp \left( \frac{\ii}{\hbar} \int_{t_0}^t \dd{t} \hat{H}^H_i (t) \right) \ket{\psi^I(t)},
\]
做一个绘景变换就得到
\begin{equation}
    \ii \hbar \dv{t} \ket{\psi^I (t)} = \hat{H}^I_i (t) \ket{\psi^I (T)}.
    
\end{equation}
相互作用绘景中算符随时间的演化使用的$\hat{H}_0$由于不含时，无论在海森堡绘景下还是在相互作用绘景下都是一样的，无需特殊的变换。
在$\hat{H}_i^H$在各个时间点的值彼此对易时，
\[
    \comm{T \exp \left( \frac{\ii}{\hbar} \int_{t_0}^t \dd{t} \hat{H}^H_i (t) \right)}{\hat{H}_i^H(t')} = 0,
\]
于是可以将$\hat{H}^I_i$和$\hat{H}^H_i$的关系式中的时间演化算符移动到一起，让它们抵消，从而证明$\hat{H}^I_i(t)$和$\hat{H}^H_i(t)$相等。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{线性响应}\label{sec:linear-response}

\subsubsection{推迟格林函数}

设我们在体系中加入一个可观察量微扰$\hat{A}$：
\begin{equation}
    \hat{H}' = \hat{H} - h(t) \hat{A},
\end{equation}
其中$h(t)$是一个含时的系数。%
\footnote{如果我们使用$+ h(t) \hat{A}$形式的哈密顿量，计算得到的响应就会差一个负号。}%
我们要求$h(t)$被缓慢地施加，而又缓慢地被撤去，从而系统初态（也即，$t=-\infty$时的状态）可以看成平衡态。
记密度算符$\hat{\rho}$在$t=-\infty$时的状态为$\hat{\rho}_0$。
显然微扰会改变系统的行为。计算受到微扰的系统中某不含时的可观察量$\hat{B}$的期望偏离平衡态的程度（下标0表示这是对没有加过微扰的系统取平均，也就是按照$\hat{\rho}_0$取平均）：
\[
    y(t) = \expval*{\hat{B}}(t) - \expval*{\hat{B}}_0 = \trace\left((\hat{\rho} - \hat{\rho}_0)\hat{B}\right).
\]
前面提到这是微扰，因此$y(t)$和$h(t)$的关系近似是线性的（这就是我们正在讨论的理论称为\textbf{线性响应}理论的原因），从而我们可以使用一个响应函数联系两者，即
\[
    y(t) = \int \dd{t'} G(t, t') h(t').
\]
我们要求系统具有因果律，这意味着，在$t<t'$时应有$G(t,t')=0$，否则某一时刻的$h(t')$将会影响过去时间的$y(t)$。因此我们有
\[
    G(t,t') \propto \Theta(t-t'),
\]
且积分可以写成
\[
    y(t) = \int_{-\infty}^t \dd{t'} G(t, t') h(t').
\]

切换到相互作用绘景下。取$\hat{H}$为自由哈密顿量，$-h(t)\hat{A}$为相互作用哈密顿量，那么演化方程就是
\[
    \dv{\hat{\rho}^I}{t} = \frac{\ii}{\hbar} \comm*{\hat{\rho}^I}{-h(t)\hat{A}^I(t)} = \frac{\ii}{\hbar} h(t) \comm*{\hat{A}^I(t)}{\hat{\rho}^I}.
\]
上式等价于积分方程
\[
    \hat{\rho}^I(t) = \hat{\rho}_0^I + \frac{\ii}{\hbar}  \int_{-\infty}^t \dd{t'} h(t') \comm*{\hat{A}^I(t')}{\hat{\rho}^I(t')}.
\]
事实上，$\hat{\rho}_0^I$就是$\hat{\rho}_0$，因为$\hat{\rho}_0$为
\[
    \hat{\rho}_0 = \frac{1}{Z} \ee^{-\beta \hat{H}},
\]
从而
\[
    \hat{\rho}_0^I = \ee^{-\frac{\ii}{\hbar}t \hat{H}} \hat{\rho}_0 \ee^{\frac{\ii}{\hbar}t \hat{H}} = \hat{\rho}_0.
\]
由于$h(t)$非常小，$\hat{\rho}^I$的变化不是特别大，于是取以上方程的一阶近似，得到
\[
    \hat{\rho}^I(t) = \hat{\rho}_0 + \frac{\ii}{\hbar}  \int_{-\infty}^t \dd{t'} h(t') \comm*{\hat{A}^I(t')}{\hat{\rho}_0}.
\]
于是可以计算出$y(t)$：%
\footnote{请注意迹运算无论是在相互作用绘景还是在薛定谔绘景下都是一样的。}
\[
    \begin{aligned}
        y(t) &= \trace \left\{ (\hat{\rho}^I(t) - \hat{\rho}^I_0) \hat{B}^I(t) \right\} \\
        &= \frac{\ii}{\hbar} \int_{-\infty}^t \dd{t'} h(t') \trace \left\{ \comm*{\hat{A}^I(t')}{\hat{\rho}_0} \hat{B}^I(t) \right\},
    \end{aligned}
\]
利用迹运算的轮换性，得到
\[
    \trace \left\{ \comm*{\hat{A}^I(t')}{\hat{\rho}_0} \hat{B}^I(t) \right\} = \trace \left\{ \hat{\rho}_0 \comm*{\hat{B}^I(t)}{\hat{A}^I(t')} \right\},
\]
于是最终得到
\[
    \begin{aligned}
        y(t) &= \frac{\ii}{\hbar} \int_{-\infty}^t \dd{t'} h(t') \trace \left\{ \hat{\rho}_0 \comm*{\hat{B}^I(t)}{\hat{A}^I(t')} \right\} \\
        &= \frac{\ii}{\hbar} \int_{-\infty}^t \dd{t'} h(t') \expval*{\comm*{\hat{B}^I(t)}{\hat{A}^I(t')} }_0.
    \end{aligned}
\]
最后，注意到以$\hat{H}$为自由哈密顿量的相互作用绘景中的算符实际上就是以$\hat{H}$为哈密顿量的海森堡绘景中的算符，于是我们写出$y(t)$和$h(t')$之间的响应函数：
\[
    G(t,t') = \frac{\ii}{\hbar} \Theta(t-t') \expval*{\comm*{\hat{B}^H(t)}{\hat{A}^H(t')}}_0.
\]
为了更加明确，通常使用下面的记号：
\begin{equation}
    G(t,t')^\text{ret}_{BA} = \frac{\ii}{\hbar} \Theta(t-t') \expval*{\comm*{\hat{B}(t)}{\hat{A}(t')}}.
    \label{eq:retarded-green-function}
\end{equation}
上标ret表示这是\textbf{推迟格林函数}（retarded），下标表示扰动和响应。所谓“推迟”不代表该格林函数在时间上是非局域的，而是表示向后的因果性。
默认体系不受到微扰，且算符$\hat{A}$和$\hat{B}$默认处于无微扰的海森堡绘景中，于是略去期望值的下标0和算符的上标。

实际我们做实验分析一个系统的性质时，都是对系统施加某个输入（敲它以下、加上一个磁场、通电，等等），然后测量对应的响应，因此只需要计算出我们关心的过程（例如，外加电场会导致通电，即外加$\vb*{E}$导致$\vb*{j}$）的推迟格林函数，就确定了这个过程的性质。只需要推迟格林函数就够了。于是接下来来分析推迟格林函数的性质。

\subsubsection{涨落耗散定理}

本节展示推迟格林函数的一个非常重要的性质。采取海森堡绘景，定义两个算符的\textbf{关联函数}为
\begin{equation}
    S_{BA}(t,t') = \expval*{\hat{B}(t)\hat{A}(t')} - \expval*{\hat{B}(t)}\expval*{\hat{A}(t')}.
\end{equation}
我们可以不失一般性地对各个算符做一个平移，从而让它们的期望值为零，即做变换
\[
    \hat{A} \longrightarrow \var{\hat{A}} = \hat{A} - \expval*{\hat{A}},
\]
于是不失一般性地认为所有算符的期望值都为零，从而
\begin{equation}
    S_{BA}(t,t') = \expval*{\hat{B}(t)\hat{A}(t')}.
\end{equation}

由于哈密顿量不含时，我们有时间平移对称性，于是
\begin{equation}
    G_{BA}^\text{ret}(t,t') = G_{BA}^\text{ret}(t-t'), \quad S_{BA}(t,t') = S_{BA}(t-t').
\end{equation}
于是可以定义一个单变量傅里叶变换：
\begin{equation}
    S_{BA}(\omega) = \int_{-\infty}^\infty \dd{t} S_{BA}(t) \ee^{\ii \omega t}, \quad G_{BA}^\text{ret}(\omega) = \int_{-\infty}^\infty \dd{t} G_{BA}^\text{ret}(t) \ee^{\ii \omega t}.
\end{equation}
实际上由\eqref{eq:retarded-green-function}，$t<0$处推迟格林函数为零，从而
\[
    G_{BA}^\text{ret}(\omega) = \int_0^\infty \dd{t} G_{BA}^\text{ret}(t) \ee^{\ii \omega t}.
\]
那么，我们有\textbf{涨落耗散定理}：%
\footnote{频域上的响应函数的虚部代表了耗散，而关联函数则代表了两个物理量共同涨落的强弱。}
\begin{equation}
    \Im G_{BA}^\text{ret}(\omega) = \frac{1 - \ee^{-\beta\hbar\omega}}{2\hbar} S_{BA}(\omega).
\end{equation}

下面我们来证明这一点。首先注意到，$h(t)$和$y(t)$都是实数，从而联系它们的推迟格林函数也一定是实数，这样就有
\[
    \begin{aligned}
        \Im G_{BA}^\text{ret}(\omega) &= \frac{1}{2\ii} \left( G_{BA}^\text{ret}(\omega) -( G_{BA}^\text{ret}(\omega))^* \right) \\
        &= \frac{1}{2\ii} \left( \int_0^\infty \dd{t} \ee^{\ii \omega t} G_{BA}^\text{ret}(t) -\int_0^\infty \dd{t} \ee^{- \ii \omega t} G_{BA}^\text{ret}(t) \right) \\
        &= \frac{1}{2\ii} \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} G_{BA}^\text{ret}(t) \\
        &= \frac{1}{2\hbar} \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \expval{\comm{\hat{B}(t)}{\hat{A}(0)}} \\
        &= \frac{1}{2\hbar} \left( \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \hat{B}(t) \hat{A}(0) - \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \hat{A}(0) \hat{B}(t) \right).
    \end{aligned}
\]
第一项正是关联函数。对第二项，
\[
    \begin{aligned}
        \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \hat{A}(0) \hat{B}(t) &= \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \frac{1}{Z} \trace \left( \ee^{-\beta \hat{H}} \hat{A}(0) \ee^{\frac{\ii}{\hbar} \hat{H} t} \hat{B}(0) \ee^{ - \frac{\ii}{\hbar} \hat{H} t} \right) \\
        &= \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \frac{1}{Z} \trace \left( \ee^{-\beta\hat{H}} \hat{A}(0) \ee^{-\beta \hat{H}} \ee^{\beta \hat{H}} \ee^{\frac{\ii}{\hbar} \hat{H} t} \hat{B}(0) \ee^{ - \frac{\ii}{\hbar} \hat{H} t} \right) \\
        &= \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \frac{1}{Z} \trace \left( \ee^{-\beta \hat{H}} \ee^{\beta \hat{H}} \ee^{\frac{\ii}{\hbar} \hat{H} t} \hat{B}(0) \ee^{ - \frac{\ii}{\hbar} \hat{H} t} \ee^{-\beta\hat{H}} \hat{A}(0) \right) \\
        &= \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \frac{1}{Z} \trace \left( \ee^{-\beta \hat{H}} \ee^{\frac{\ii}{\hbar} \hat{H} (t - \ii \hbar \beta)} \hat{B}(0) \ee^{ - \frac{\ii}{\hbar} \hat{H} (t - \ii \hbar \beta)} \hat{A}(0) \right) \\
        &= \int_{-\infty+\ii\hbar\beta}^{\infty+\ii\hbar\beta} \dd{t} \ee^{\ii \omega (t + \ii \hbar \beta)} \frac{1}{Z} \trace \left( \ee^{-\beta \hat{H}} \ee^{\frac{\ii}{\hbar} \hat{H} t} \hat{B}(0) \ee^{ - \frac{\ii}{\hbar} \hat{H} t} \hat{A}(0) \right).
    \end{aligned}
\]
被积函数在区域$0 < \Im t < \hbar \beta$内是解析的，从而就有
\[
    \begin{aligned}
        \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \hat{A}(0) \hat{B}(t)  &= \ee^{-\omega \hbar \beta} \int_{-\infty+\ii\hbar\beta}^{\infty+\ii\hbar\beta} \dd{t} \ee^{-\ii \omega t} \frac{1}{Z} \trace \left( \ee^{-\beta \hat{H}} \ee^{\frac{\ii}{\hbar} \hat{H} t} \hat{B}(0) \ee^{ - \frac{\ii}{\hbar} \hat{H} t} \hat{A}(0) \right) \\
        &= \ee^{-\omega \hbar \beta} \int_{-\infty}^{\infty} \dd{t} \ee^{-\ii \omega t} \frac{1}{Z} \trace \left( \ee^{-\beta \hat{H}} \ee^{\frac{\ii}{\hbar} \hat{H} t} \hat{B}(0) \ee^{ - \frac{\ii}{\hbar} \hat{H} t} \hat{A}(0) \right),
    \end{aligned}
\]
于是就证明了涨落耗散定理。

\subsubsection{Kramers-Kronig关系}

实际上，推迟格林函数的实部和虚部也有关系。要看出这个关系只需要利用推迟格林函数的两个性质：
\begin{itemize}
    \item 因果性，即$G_{BA}^\text{ret}(t)$在$t<0$时为零；
    \item 频谱至少衰减得和$1/\omega$一样快，这个条件实际上需要额外的确认，但通常是成立的，因为当
\end{itemize}

第一个条件，也就是，因果律，意味着$G_{BA}^\text{ret}(\omega)$在上半平面上是解析的。这是因为
\[
    G_{BA}^\text{ret}(t) = \frac{1}{2\pi} \int_{-\infty}^\infty \dd{t} G_{BA}^\text{ret}(\omega) \ee^{-\ii\omega t},
\]
在$t<0$时能够保证在上半平面上，$\omega\to\inf$时$\ee^{-\ii \omega t}$快速衰减，于是
\[
    G_{BA}^\text{ret}(t) = \frac{1}{2\pi} \cdot 2 \pi \sum_\text{upper plane}  \Res G_{BA}^\text{ret}(\omega) \ee^{-\ii\omega t},
\]
在$t<0$时上式一定是零，从而上半平面上必定没有奇点，从而$G_{BA}^\text{ret}(\omega)$在上半平面上是解析的。
相应的，如果系统不是平凡的，那么下半平面一定有奇点，因为$t<0$时应当在下半平面取留数。

现在考虑积分
\[
    \int_{-\infty}^\infty \dd{\omega'} \frac{G_{BA}^\text{ret}(\omega')}{\omega' - \omega + \ii 0^+},
\]
被积函数仅有的奇点位于下半平面，因此它在上半平面和实轴上处处解析，从而
\[
    \oint \dd{\omega'} \frac{G_{BA}^\text{ret}(\omega')}{\omega' - \omega + \ii 0^+} = 0.
\]
另一方面，设$C$是上半平面上的辐角从$0$到$\pi$的大圆弧，由于$G_{BA}^\text{ret}(\omega)$衰减得很快，由大圆弧引理，
\[
    \int_C \dd{\omega} \frac{G_{BA}^\text{ret}(\omega')}{\omega' - \omega + \ii 0^+} = 0.
\]
那么，取实轴和大圆弧组成一个闭合回路，在这个闭合回路上的积分是零，在大圆弧上的积分还是零，于是实轴上的积分也是零，
\[
    \int_{-\infty}^\infty \dd{\omega'} \frac{G_{BA}^\text{ret}(\omega')}{\omega' - \omega + \ii 0^+} = 0.
\]
而这个积分可以通过经典的“将奇点移动到实轴而改变积分路径”的方法计算出来，或者等价地，使用公式
\[
    \frac{1}{\omega'-\omega+\ii 0^+} = \primevalue \frac{1}{\omega'-\omega} - \pi \ii \delta(\omega'-\omega),
\]
其中$\primevalue$表示柯西积分主值，就得到
\[
    0 = \int_{-\infty}^\infty \dd{\omega'} \left( \Re G_{BA}^\text{ret}(\omega') + \ii \Im G_{BA}^\text{ret}(\omega') \right) \left( \primevalue \frac{1}{\omega'-\omega} - \pi \ii \delta(\omega'-\omega) \right),
\]
分别取实部和虚部，就得到
\begin{equation}
    \begin{bigcase}
        \Re G_{BA}^\text{ret}(\omega) &= \frac{1}{\pi} \primevalue \int_{-\infty}^\infty \dd{\omega'} \frac{\Im G_{BA}^\text{ret}(\omega')}{\omega' - \omega}, \\
        \Im G_{BA}^\text{ret}(\omega) &= - \frac{1}{\pi} \primevalue \int_{-\infty}^\infty \dd{\omega'} \frac{\Re G_{BA}^\text{ret}(\omega')}{\omega' - \omega}.
    \end{bigcase}
\end{equation}
因此，推迟格林函数的实部和虚部之间可以相互换算。

总之，在频域上，推迟格林函数的实部、虚部和关联函数这三者是一一对应的，因此实际的自由度只有一个。

\subsubsection{谱函数}\label{sec:spectral-function}

定义
\begin{equation}
    A_{BA}(\omega) = \frac{1}{\pi} \Im G_{BA}^\text{ret}(\omega) = \frac{1}{2 \pi \hbar} \int_{-\infty}^\infty \dd{t} \expval*{\comm*{\hat{B}(t)}{\hat{A}(0)}} \ee^{\ii \omega t}
\end{equation}
为\textbf{谱函数}。当然，推迟格林函数可以很容易地使用谱函数表示出来：
\begin{equation}
    \begin{bigcase}
        \Re G_{BA}^\text{ret}(\omega) &= \primevalue \int_{-\infty}^\infty \dd{\omega'} \frac{A_{BA}(\omega)}{\omega'-\omega} , \\
        \Im G_{BA}^\text{ret}(\omega) &= \pi A_{BA}(\omega).
    \end{bigcase}
\end{equation}
或者，考虑到
\[
    \frac{1}{\omega'-\omega-\ii 0^+} = \primevalue \frac{1}{\omega'-\omega} + \ii \pi \delta(\omega'-\omega),
\]
就是
\begin{equation}
    G_{BA}^\text{ret}(\omega) = \int_{-\infty}^\infty \dd{\omega'} \frac{A_{BA}(\omega')}{\omega' - \omega - \ii 0^+}.
\end{equation}
这表明谱函数给出了推迟格林函数在不同频率上的分布情况。当$\omega\to 0$时，我们有
\[
    G_{BA}^\text{ret}(\omega) \sim \int_{-\infty}^\infty \dd{\omega'} \frac{A_{BA}(\omega')}{\omega' - \ii 0^+},
\]
而当$\omega\to \infty$时，我们有
\[
    G_{BA}^\text{ret}(\omega) \sim - \int_{-\infty}^\infty \dd{\omega'} \frac{A_{BA}(\omega')}{\omega},
\]
这表明外加驱动频率很低时和外加驱动频率很高时产生的响应的正负号是反的。这是谐振子对外加驱动的响应的一种推广：当驱动频率很小时，体系能够很好地跟上外加驱动，当驱动频率特别大时，体系几乎总是落在外加驱动后面。

到现在为止谱函数仅仅是纯形式的记号。现在我们要说明怎样通过哈密顿量得到谱函数，这个过程称为\textbf{谱表示}。由于通常并不能解出哈密顿量，谱表示的理论意义大于实际计算意义。
设哈密顿量被对角化为
\[
    \hat{H} \ket{n} = E_n \ket{n},
\]
则
\[
    \begin{aligned}
        A_{BA} (\omega) &= \frac{1}{\pi} \Im G_{BA}(\omega) \\
        &= \frac{1}{2 \pi \hbar} \int_{-\infty}^\infty \dd{t} \expval*{\comm*{\hat{B}(t)}{\hat{A}(0)}} \ee^{\ii \omega t} \\
        &= \frac{1}{2 \pi \hbar} \int_{-\infty}^\infty \dd{t} \ee^{\ii \omega t} \frac{1}{Z} \\
        & \quad \quad \times \sum_m \left( \mel{m}{\ee^{-\beta E_m} \ee^{\frac{\ii}{\hbar} E_m t} \hat{B}(0) \ee^{- \frac{\ii}{\hbar} \hat{H} t} \hat{A}(0) }{m} - \mel{m}{\ee^{-\beta E_m} \hat{A}(0) \ee^{\frac{\ii}{\hbar} \hat{H} t} \hat{B}(0) \ee^{- \frac{\ii}{\hbar} E_m t} }{m} \right).
    \end{aligned}
\]
上式中我们已经将紧邻左矢或右矢的哈密顿算符写成了本征值的形式。通过在每一个期望值中间再插入一组完备正交基，我们得到
\[
    \begin{aligned}
        &\quad \mel{m}{\ee^{-\beta E_m} \ee^{\frac{\ii}{\hbar} E_m t} \hat{B}(0) \ee^{- \frac{\ii}{\hbar} \hat{H} t} \hat{A}(0) }{m} \\
        &= \sum_n \mel{m}{\ee^{-\beta E_m} \ee^{\frac{\ii}{\hbar} E_m t} \hat{B}(0)}{n} \mel{n}{\ee^{- \frac{\ii}{\hbar} E_n t \hat{A}(0) }}{m} \\
        &= \ee^{- \beta E_m} \ee^{\frac{\ii}{\hbar} (E_m - E_n)} \sum_n \mel{m}{\hat{B}(0)}{n} \mel{n}{\hat{A}(0)}{m},
    \end{aligned}
\]
同理
\[
    \begin{aligned}
        &\quad \mel{m}{\ee^{-\beta E_m} \hat{A}(0) \ee^{\frac{\ii}{\hbar} \hat{H} t} \hat{B}(0) \ee^{- \frac{\ii}{\hbar} E_m t} }{m} \\
        &= \sum_n \mel{m}{\ee^{-\beta E_m} \hat{A}(0) \ee^{\frac{\ii}{\hbar} E_n t}}{n} \mel{n}{\hat{B}(0) \ee^{- \frac{\ii}{\hbar} E_m t}}{m} \\
        &= \ee^{-\beta E_m} \ee^{\frac{\ii}{\hbar} (E_n - E_m) t} \sum_n \mel{m}{\hat{A}(0)}{n} \mel{n}{\hat{B}(0)}{m}.
    \end{aligned}
\]
通过交换第二项中的$m$和$n$，并计算有关积分，就得到
\begin{equation}
    A_{BA}(\omega) = \frac{1}{\hbar Z} \sum_{m,n} \left( \ee^{-\beta E_m} - \ee^{-\beta E_n} \right) \mel{m}{\hat{B}}{n} \mel{n}{\hat{A}}{m} \delta\left( \omega + \frac{E_m - E_n}{\hbar} \right).
\end{equation}
这就是谱表示的具体表达式。考虑到狄拉克函数的性质，可以写出一个不那么对称的表达式：
\begin{equation}
    A_{BA}(\omega) = \frac{1}{\hbar Z} \sum_{m,n} \ee^{-\beta E_m} (1 - \ee^{- \beta \hbar \omega}) \mel{m}{\hat{B}}{n} \mel{n}{\hat{A}}{m} \delta\left( \omega + \frac{E_m - E_n}{\hbar} \right). 
\end{equation}

从谱表示出发可以获得涨落耗散定理的另一个证明，因为我们可以证明关联函数的形式实际上和谱表示只差了一个常数因子。