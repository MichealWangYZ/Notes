\documentclass[hyperref, UTF8, a4paper]{ctexart}

\usepackage{geometry}
\usepackage{titling}
\usepackage{titlesec}
\usepackage{paralist}
\usepackage{footnote}
\usepackage{enumerate}
\usepackage{amsmath, amssymb, amsthm}
\usepackage{cite}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{physics}
\usepackage{tikz}
\usepackage[colorlinks, linkcolor=black, anchorcolor=black, citecolor=black]{hyperref}
\usepackage{prettyref}

\geometry{left=3.18cm,right=3.18cm,top=2.54cm,bottom=2.54cm}
\titlespacing{\paragraph}{0pt}{1pt}{10pt}[20pt]
\setlength{\droptitle}{-5em}
\preauthor{\vspace{-10pt}\begin{center}}
\postauthor{\par\end{center}}

\DeclareMathOperator{\timeorder}{T}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\legpoly}{P}
\DeclareMathOperator{\sgn}{sgn}
\newcommand*{\ii}{\mathrm{i}}
\newcommand*{\ee}{\mathrm{e}}
\newcommand*{\const}{\mathrm{const}}
\newcommand*{\comment}{\paragraph{注记}}
\newcommand*{\suchthat}{\quad \text{s.t.} \quad}
\newcommand*{\argmin}{\arg\min}
\newcommand*{\argmax}{\arg\max}
\newcommand*{\normalorder}[1]{: #1 :}
\newcommand*{\pair}[1]{\langle #1 \rangle}

\newrefformat{sec}{第\ref{#1}节}
\newrefformat{note}{注\ref{#1}}
\renewcommand{\autoref}{\prettyref}

\newenvironment{bigcase}{\left\{\quad\begin{aligned}}{\end{aligned}\right.}

\title{固体理论}
\author{吴何友}

\begin{document}

\maketitle

记号约定：费米子的产生湮灭算符为$\hat{c}^\dagger$和$\hat{c}$，而如果是关于位置的产生湮灭算符，则为$\hat{\psi}^\dagger$和$\hat{\psi}$。
本文提到的费米子主要是电子，使用一个三维坐标$\vb*{r}$（或者三位动量$\vb*{p}$），以及只有向上和向下两种选择的自旋就可以描述一个电子。
单电子自旋算符为
\[
    \hat{\vb*{S}} = \sum_{\alpha, \beta} \ket{\alpha} \vb*{\sigma}_{\alpha \beta} \bra{\beta},
\]
其中$\alpha$和$\beta$取遍$\uparrow$和$\downarrow$，$\sigma$为泡利矩阵。

由于本文不涉及相对论性过程，设$\vb*{a}$为一个矢量，则使用$a$表示其模长。

本文取普朗克单位制，即认为$\hbar=c=1$，且$4\pi\epsilon_0=1$，$k_B=1$。

$\text{h.c.}$表示厄米共轭，$\text{c.c.}$表示复共轭。

对离散格点系统，使用$\pair{i, j}$表示最接近的一对格点。

在不涉及自旋-轨道耦合的场合，在书写哈密顿量时我们直接略去自旋的下标，这是合理的，因为只需要把不考虑自旋的哈密顿量中的各个产生湮灭算符根据自旋守恒的性质机械地加上自旋下标再求和就能够得到完整的哈密顿量。
在需要实际计算粒子数时就不能这么做了。

\section{物质的组成}

\subsection{离子实和价电子}

普通的固体、液体、气体由一系列原子组成。通过实验和计算可以发现，原子的最外层电子在各种过程中容易发生重新排列，称为\textbf{价电子}；内层电子和原子核（合称为\textbf{离子实}）则通常保持为一个整体，也即，其内部状态发生变化的物理过程的描述需要使用QCD，其涉及的能标远高于价电子发生变化涉及的能标。

本文基本上只分析涉及价电子低能运动的物理过程，即只讨论非相对论极限下的电荷-电磁场耦合系统，带电粒子由薛定谔场完全描述，电磁场由库伦势完全描述。由此产生的系统具有$U(1)$对称性，因此无粒子数生灭，可以直接从单粒子量子力学出发构造其哈密顿量。而又由于体系很大，通常有确定的粒子数。
设有$N_e$个价电子，$N_i$个离子实（i表示离子）。
固体的（一次量子化）哈密顿量就是
\begin{equation}
    \hat{H} = \hat{H}_\text{e} + \hat{H}_\text{i} + \hat{H}_\text{ei},
    \label{eq:many-body-hamiltonian}
\end{equation}
其中$\hat{H}_\text{e}$表示仅涉及价电子的哈密顿量，$\hat{H}_\text{i}$表示仅涉及离子实的哈密顿量，最后一项则是两者的相互作用。

诸价电子组成的系统就好像由电子组成的气体，称为\textbf{相互作用电子气}。单体哈密顿量为电子的动能项加上单体势能项。在物质不受外界作用时当然不应该有单体势能项，于是
\[
    \hat{H}_\text{e1} = \frac{\hat{\vb*{p}}^2}{2m},
\]
在坐标表象下它就是
\[
    \hat{H}_\text{e1} = - \frac{\laplacian}{2m}.
\]
二体哈密顿量为电子两两作用而产生的库伦势能是
\[
    \hat{H}_\text{e2} = \frac{e^2}{\abs{\vb*{r}_1 - \vb*{r}_2}},
\]
从而价电子本身的能量以及它们之间发生库伦相互作用的能量就是
\begin{equation}
    \hat{H}_\text{e} = \sum_{i=1}^{N_\text{e}} \frac{\hat{p}_i^2}{2m_\text{e}} + \frac{1}{2} \sum_{i\neq j} \frac{e^2}{\abs{\vb*{r}_i - \vb*{r}_j}}.
\end{equation}

使用类似的方法，离子实的组成的系统（如果是晶体那就是晶格）的哈密顿量为
\begin{equation}
    \hat{H}_\text{i} = \sum_{\alpha=1}^{N_\text{i}} \frac{\hat{p}_\alpha^2}{2m_i} + \frac{1}{2} \sum_{\alpha\neq\beta} V(\vb*{R}_\alpha-\vb*{R}_\beta).
\end{equation}
由于离子实中的内层电子结构复杂，离子实之间的相互作用能写不出特别简单的表达式。请注意这个相互作用能是平移不变的，这是当然的，因为QED是平移不变的；但是实际的晶体在短距离上并不是平移不变的，因为在低能下有对称性自发破缺。

离子实和价电子的相互作用则是
\begin{equation}
    \hat{H}_\text{ei} = \sum_{\alpha, i} V_\text{ei}(\vb*{r}_i-\vb*{R}_\alpha). 
\end{equation}
分别使用$i$表示价电子，用$\alpha$表示离子实；由于价电子和离子实不全同，不需要加上$1/2$系数。
同样我们还是假定了相互作用本身的平移不变性。

以上给出的所有项都不涉及自旋。的确，没有磁场的环境中自旋和其它自由度完全没有耦合，因此可以略去。

在大部分过程中，由于原子核的质量比电子的质量大至少三个数量级，涉及价电子的过程通常比涉及离子实的过程发生得快很多，从而在价电子的时间尺度上，诸离子实的位置可以看成是给定的。
从而，在分析价电子时我们可以将$\hat{H}_i$项直接略去，而将$\hat{H}_\text{ei}(\vb*{r}_i-\vb*{R}_\alpha)$项对$\vb*{R}_\alpha$求和得到$V(\vb*{r}_i)$（既然系统中没有别的势了）。这个近似称为\textbf{玻恩–奥本海默近似}。这样一来相互作用电子气的一次量子化哈密顿量在坐标表象下就是
\begin{equation}
    \hat{H} = \sum_{i=1}^{N_\text{e}} \left( - \frac{\laplacian}{2m_\text{e}} + V(\vb*{r}_i)\right) + \frac{1}{2} \sum_{i\neq j} \frac{e^2}{\abs{\vb*{r}_i - \vb*{r}_j}},
    \label{eq:electron-gas-hamiltonian}
\end{equation}
从而二次量子化哈密顿量为
\begin{equation}
    \begin{aligned}
        \hat{H} = &\int \dd[3]{\vb*{r}} \hat{\psi}^\dagger(\vb*{r}) \left( - \frac{\laplacian}{2m} + V(\vb*{r}) \right) \hat{\psi}(\vb*{r}) \\
        &+ \frac{1}{2} \int \dd[3]{\vb*{r}_1} \int \dd[3]{\vb*{r}_2} \hat{\psi}^\dagger (\vb*{r}_1) \hat{\psi}^\dagger (\vb*{r}_2) \frac{e^2}{\abs{\vb*{r}_1 - \vb*{r}_2}} \hat{\psi} (\vb*{r}_2) \hat{\psi}(\vb*{r}_1). 
        \label{eq:electron-gas-hamiltonian-sq}
    \end{aligned}
\end{equation}
其中$\hat{\psi}^\dagger(\vb*{r})$是薛定谔场的场算符，它也是在位置为$\vb*{r}$的位置产生一个电子的产生算符。这个哈密顿量当然也可以通过QED的低能近似得到，但并没有必要这么做。请注意电子是费米子。
\eqref{eq:electron-gas-hamiltonian-sq}实际上不是对角的，因为它的单粒子项涉及一个梯度算符。

需要注意的是实际上仍然可能有电子和晶格的相互作用（即电子-声子相互作用），因此波恩-奥本海默近似中的电子质量可能出现和该相互作用相关的跑动，此时\eqref{eq:electron-gas-hamiltonian-sq}中的所谓“电子”已经是一种准粒子了。

\subsection{近独立电子气}

\subsubsection{哈密顿量、分布和格林函数}

很难一上手就处理带有复杂相互作用的电子气，因此我们首先处理\textbf{近独立电子气}，也就是电子之间近似没有相互作用的电子气。此时我们可以单独考虑每个电子的哈密顿量
\begin{equation}
    \hat{H} = \frac{\hat{\vb*{p}}^2}{2m_\text{e}} + V(\vb*{r}).
\end{equation}
整团电子气的哈密顿量是关于各个电子的哈密顿量之和。

近独立电子气的基态是什么？使用巨正则系综%
\footnote{当然，我们认为系统能够达到统计平衡，就意味着电子之间不可能真的完全没有相互作用，否则能量无法传递。}%
，对很大的近独立费米子系统，处在能量本征态$\ket{n}$上的粒子数的平均值为%
\footnote{以下使用$\epsilon$表示单个电子的能量而使用$E$表示系统总能量。}%
\begin{equation}
    \expval*{\hat{n}_n} = f(\epsilon_n) = \frac{1}{\ee^{\beta (\epsilon_n-\mu)} + 1}.
    \label{eq:fermi-dirac-distribution}
\end{equation}
我们让能量尽可能低，那就是要让$T\to 0$，也就是让$\beta\to \infty$，此时就有
\begin{equation}
    \expval*{\hat{n}_n} = \begin{cases}
        1, \quad \epsilon_i \leq \mu, \\
        0, \quad \epsilon_i > \mu.
    \end{cases}
\end{equation}
这意味着，$T=0$时电子占据的所有状态就是
\begin{equation}
    \epsilon_i = \mu
\end{equation}
以内的所有能量本征态（这部分能量本征态称为\textbf{费米海}）。在动量空间中这就是一个曲面，称为\textbf{费米面}。位于费米面上的所有能量本征态共同组成了一个能量正好是零温化学势的能级，称为\textbf{费米能级}，其能量称为\textbf{费米能量}。与费米能级对应的动量称为\textbf{费米动量}。
基态的表达式就是一个乘积态，为
\begin{equation}
    \ket{\Psi} = \prod_{\abs{\vb*{k}} < k_\text{F}} \hat{c}^\dagger_{\vb*{k}} \ket{0}.
    \label{eq:ground-state}
\end{equation}

统计物理的论证只能把我们带到这里。具体化学势是多少需要根据
\begin{equation}
    \mu_i = \pdv{U}{N_i}
\end{equation}
计算。当然，化学势和粒子数、温度等因素都有关系。在$T=0$且电子数$N$给定时，常用的做法是显式地写出所有能量本征态，从小到大排列$N$个电子，从而计算出费米能量，然后我们就知道了$T=0$时的化学势。

不同粒子数对应的费米能量是不同的；并且，在分析有限温问题时，化学势不再是费米能量。然而，在温度不很高、粒子数很大时，不同粒子数对应的费米能量相差不大，并且化学势和费米能量（也就是$T=0$时的化学势）相差不大，因此有时会使用费米能量近似作为化学势。%
\footnote{关于本节的论述要着重指出一点：虽然我们采用了统计物理的论证来表明必然存在着一个费米面，从而有对应的费米能量，但统计物理的论证仅仅为我们提供了系统基态的性质，而无论系统是不是需要使用平衡态系综描述，它一定有一个基态。因此，费米面、费米能级等概念在任何情况下——无论是平衡态还是非平衡态、纯态还是混合态——全部是适用的。这些概念并不依赖统计物理的框架！}%

我们计算近独立电子气的格林函数，这就等价于计算其谱函数。既然近独立电子气可以分解成若干单电子理论，我们有
\begin{equation}
    A(\vb*{k}, \omega) = \delta(\omega - \epsilon_{\vb*{k}}),
\end{equation}
\begin{equation}
    G^\text{ret}(\vb*{k}, \omega) = \frac{1}{\omega - \epsilon_{\vb*{k}} + \ii 0^+}.
\end{equation}

\subsubsection{空穴}

虽然多电子态是将场算符作用在真空态上得到的，但由于本文讨论的电子都由薛定谔场描述，在任何一个物理过程中电子数都是守恒的。
换而言之，设有一个$N$电子的系统，这个系统实际可能具有的态矢量只是态空间的一小部分，即保持电子数为$N$的部分。
这个$N$电子空间$\mathcal{H}_N$当然可以使用一次量子化理论来描述，但能否使用二次量子化的语言描述？
费米子的特性让这一点成为可能。请注意由于泡利不相容原理，
\[
    \hat{c}^\dagger_{\vb*{k}} \ket{\Psi} = 0, \quad k < k_\text{F},
\]
而由产生湮灭算符的性质显然有
\[
    \hat{c}_{\vb*{k}} \ket{\Psi} = 0, \quad k > k_\text{F},
\]
因此如果定义% TODO:对那些正好落在费米面上的态呢？
\begin{equation}
    \hat{b}^\dagger_{\vb*{k}} = \begin{cases}
        \hat{c}_{\vb*{k}}, \quad k < k_\text{F}, \\
        \hat{c}_{\vb*{k}}^\dagger, \quad k > k_\text{F},
    \end{cases}
\end{equation}
那么基态$\ket{\Psi}$实际上是$\hat{b}^\dagger$产生的准粒子的真空态。$\hat{b}^\dagger$产生的是什么？当$k>k_\text{F}$时它产生的就是费米面以上的电子，而$k<k_\text{F}$时它产生的是费米海之内的空穴。
空穴的动量就是它占据的态如果有电子的话，这个电子的动量。
使用$\hat{b}^\dagger$写出的哈密顿量在省略一个无关紧要的常数之后为
\[
    \hat{H} = \sum_{k > k_\text{F}} \epsilon_{\vb*{k}} \hat{b}^\dagger_{\vb*{k}} \hat{b}_{\vb*{k}} - \sum_{k < k_\text{F}} \epsilon_{\vb*{k}} \hat{b}^\dagger_{\vb*{k}} \hat{b}_{\vb*{k}},
\]
因此一个空穴的能量为$-\epsilon_{\vb*{k}}$。以上的哈密顿量不是正定的，但这不会导致负能量疑难，因为费米海虽然很大，但大小有限，因此不会出现能量无限下降的问题。

使用$\hat{b}^\dagger$的结果是，保持电子数不变的相互作用需要被看成粒子数可变的，例如一个费米海中的电子被激发到费米海之上就意味着产生了一个电子-空穴对。

\subsubsection{自由电子气}

现在我们讨论最为简单的电子气，也就是$V(\vb*{r})$在物体内部为常数（可以看成零）的情况。此时可以将价电子一个个分开处理，既然它们之间没有相互作用。

我们在坐标表象下处理问题。计算单个电子的波函数：
\[
    - \frac{\laplacian}{2m_\text{e}} \psi(\vb*{r}) = \epsilon \psi(\vb*{r}),
\]
这种方程的解当然是平面波解的线性组合。一个这样的平面波解形如
\[
    \psi(\vb*{r}) \propto \ee^{\ii \vb*{k} \cdot \vb*{r}}.
\]
只能保证这个式子在物体内部成立，因为物体边界处$V(\vb*{r})$不可能是常数。
然后我们归一化这些平面波。电子可以自发地溢出物体，但是这样的概率并不大，所以我们可以简单地认为电子只会出现在物体内部（也即，物体被放置在一个无限深势陷当中）。设物体体积为$V$，就有
\[
    \int \dd[3]{\vb*{r}} \abs{\psi(\vb*{r})}^2 = 1,
\]
于是
\[
    \psi (\vb*{r}) = \frac{1}{\sqrt{V}} \ee^{\ii \vb*{k} \cdot \vb*{r}}, \quad \epsilon = \frac{k^2}{2m_\text{e}}.
\]
很容易看出这些波函数实际上是动量算符的本征态，$\vb*{k}$实际上就是动量。另一方面，这些波函数定义在坐标空间中，坐标空间中的一切都和自旋算符对易，因此这些波函数也是自旋本征态。于是动量和自旋的一组共同正交本征函数为
\begin{equation}
    \psi_{\vb*{k},\sigma} (\vb*{r}) = \frac{1}{\sqrt{V}} \ee^{\ii \vb*{k} \cdot \vb*{r}}, \quad \epsilon_{\vb*{k},\sigma} = \frac{k^2}{2m_\text{e}}.
\end{equation}
% 真的是这个名字吗？这些波函数称为\textbf{布洛赫波函数}。
$\vb*{k}$能够取什么值取决于边界条件。由于物体通常比较大，具体取什么样的边界条件对物体内部的过程毫无影响。

\subsubsection{费米液体理论}

以上讨论的电子气都没有相互作用。朗道注意到，很多相互作用电子气的行为和自由电子气实际上非常相似，参数可能不同但是定性行为都是一样的。
这是因为对自由电子气系统，我们可以浸染地将相互作用加入，如果相互作用强度较小，这只会带来电子的自能修正，这样的近独立“电子气”称为\textbf{费米液体}。%
\footnote{由于从气体到液体的相变没有出现任何对称性破缺，应当使用完全一样的哈密顿量来描写气体和液体。于是我们将粒子间相互作用弱的系统称为气体，将有一定的相互作用但是还没有出现晶格的系统称为液体。}%
如果相互作用较强，虽然加入相互作用之后表面上理论还是加了自能修正的电子气，但是能标较低时就可能出现相变。
费米液体中的“电子”实际上并不是电子——想象一个电子在实际的电子气的费米面外面运动，由于相互作用，会“激起一片涟漪”，这样导致的一系列电子的集体运动模式就是准粒子，费米液体中的粒子实为这种准粒子。
由于相互作用等价于加入了自能修正，准粒子的自旋没有发生变化，但是质量发生了变化，且格林函数中会出现一个明显的虚部，即粒子寿命有限。

通常准粒子的寿命在接近费米面时比较长，因此看起来像是“真正的”粒子（否则会有非常明显的能级展宽）。
这件事的原因如下。设准粒子寿命为$\tau$，则$\tau$反比于散射速率，而散射速率正比于库仑相互作用的强度。完整地做这个计算是很困难的，因为涉及到静电屏蔽等复杂的效应。
由于我们只做数量级估计，暂时将寿命对整个费米面做平均，从而使用一个常数$M$表示相互作用强度。
散射的过程可以概括为：一个动量为$\vb*{p}$的费米面外部的电子（实际上是费米液体中的准粒子，下同）的能量降低，变成了动量为$\vb*{p}_1$的电子，同时激发了一个费米面内的动量为$\vb*{p}_2$的电子。
结果是，动量为$\vb*{p}$的费米面以外的电子衰变成了两个电子，动量分别为$\vb*{p}_1$和$\vb*{p} - \vb*{p}_1 + \vb*{p}_2$，还有一个动量为$\vb*{p}_2$的空穴。
设动量分别为$\vb*{p}_1$和$\vb*{p} - \vb*{p}_1 + \vb*{p}_2$的两个电子和动量为$\vb*{p}_2$的空穴的总态密度在当前温度下的期望值为$n$，由费米黄金法则有
\[
    \frac{1}{\tau} \propto \text{transition rate} \sim \abs{M}^2 n.
\]
由于系统中的电子非常多，不同能级上电子数的涨落可以略去，即认为不同能级上不多不少正好就有费米-狄拉克分布\eqref{eq:fermi-dirac-distribution}给出的电子个数，%
\footnote{这是热力学系统的一般性质：系统规模大时涨落可略去。由于本文涉及的系统都是多体系统，总是可以做这样的近似。}%
那么就有
\[
    n = \int \dd[3]{\vb*{p}_1} \int \dd[3]{\vb*{p}_2} (1 - f(\epsilon_{\vb*{p}_1})) f(\epsilon_{\vb*{p}_2}) (1 - f(\epsilon_{\vb*{p} - \vb*{p}_1 + \vb*{p}_2})) \delta(\epsilon_{\vb*{p}} - \epsilon_{\vb*{p}_1} + \epsilon_{\vb*{p}_2} - \epsilon_{\vb*{p} - \vb*{p}_1 + \vb*{p}_2}).
\]
因子$(1-\epsilon_{\vb*{p}_1})$表示动量为$\vb*{p}_1$的电子应该占据一个空态（或者说在接近零温时应该在费米面以外），因子$f(\epsilon_{\vb*{p}_2})$表示空穴一定来自一个已有的电子，最后的$\delta$函数强制要求能量守恒。
我们不严格计算这个积分，而是做一些数量级估计。用$\xi$表示从费米面量起的能量，即$\xi = \epsilon - \mu$。
由于$\vb*{p}_2$在费米面以下而$\vb*{p}- \vb*{p}_1 + \vb*{p}_2$在费米面以上，容易写出以下不等式
\[
    0 < \xi_{\vb*{p}_1} < \xi_{\vb*{p}}, \quad 0 < - \xi_{\vb*{p}_2} < \xi_{\vb*{p}} - \xi_{\vb*{p}_1} < \xi_{\vb*{p}},
\]
对$n$有贡献的$\vb*{p}_1$和$\vb*{p}_2$均满足这些不等式，这些不等式给出了两个宽度为$\xi_{\vb*{p}}$的球壳，因此
\[
    n \leq (4 \pi k_\text{F}^2 \xi_{\vb*{p}})^2,
\]
于是
\begin{equation}
    \frac{1}{\tau} \lesssim \xi_{\vb*{p}}^2.
\end{equation}
因此，如果准粒子非常接近费米液体的费米面，那么它是非常稳定的，因为此时$\xi_{\vb*{p}}$很小。从物理图像上看，此时的准粒子虽然会和费米海中的准粒子发生相互作用，但其能量不足以产生电子-空穴对，因此也不会衰变。

通常只分析费米面附近的物理，部分原因在于只有这里才确定有稳定的准粒子，部分原因在于费米海的结构可以非常复杂。
考虑一个能量本征态，其中准粒子在费米面之上的数量为$\var{n}$，则总是把能量本征值相对于零温平衡态（由于费米海的结构可以非常复杂，平衡态能量反而是算不出来的）的变化写成以下级数展开：
\begin{equation}
    \var{E} = \sum_{\vb*{k}, \sigma} \epsilon^0_{\vb*{k}} \var{n_{\vb*{k} \sigma}} + \frac{1}{2V} \sum_{\vb*{k}, \vb*{k}', \sigma, \sigma'} f_{\sigma \sigma' \vb*{k} \vb*{k}'} \var{n_{\vb*{k} \sigma}} \var{n_{\vb*{k}' \sigma'}},
\end{equation}
取前两项，因为一些微扰论计算表明前两项有时是同阶的，后面的高阶项（对应多体相互作用）则可以略去。
$\epsilon^0_{\vb*{k}}$是一个等效的单粒子能量。由于只讨论费米面附近的理论，我们让能量从费米面量起，即使用$\xi$代替$\epsilon$，$k=k_\text{F}$时$\xi^0_{\vb*{k}}$就是零，于是可以做展开
\[
    \xi^0_{\vb*{k}} = \frac{k_\text{F}}{m^*} (k - k_\text{F})
\]
我们仿照自由电子的能量
\[
    \xi_{\vb*{k}} = \frac{k^2}{2m} - \frac{k_\text{F}^2}{2m} \approx \frac{k_\text{F}}{m} (k - k_\text{F})
\]
得到了一个等效质量$m^*$。可以根据对称性展开$f$，如使用勒让德多项式

无量纲参数

\subsubsection{平均场近似和Hatree-Fock近似}

电子气的哈密顿量涉及复杂的相互作用项，这意味着我们难以求解它，甚至不能精确求解其基态。
例如，考虑一个粒子数给定的系统，从而可以从其二次量子化哈密顿量写出一次量子化哈密顿量（未必真的要写出，只需要知道粒子数对不上的态全部可以弃去即可），如果系统的哈密顿量是二次型的，则基态可以确定是一个乘积态，粒子从低到高占据能量尽可能低的能级；但如果有相互作用，那么根本就谈不上有特别明确的能级。

\textbf{平均场近似}是一种化解这个问题的方式，在其中，我们将粒子间的相互作用看成是一个外加的场（就是所谓的平均场），从而让系统的哈密顿量解耦为一系列单粒子哈密顿量的叠加。
这样系统就可以看成自由场，其基态可以写成乘积态，其坐标表象就是Slater行列式。
这样的好处在于可以充分利用自由场的特有性质，如Wick定理。

例如，考虑相互作用电子气。对接近平衡态的体系，在我们考虑的空间尺度相对于单电子的特征尺度非常大时（例如，如果没有特别剧烈的电子-电子散射，从而诸电子可以认为离得很远），可以使用库伦相互作用能的期望值代替其本身。这个期望值为
\[
    \begin{aligned}
        \expval*{\hat{H}_\text{columbic}} &= \frac{1}{2} \int \dd[3]{\vb*{r}_1} \int \dd[3]{\vb*{r}_2} \frac{e^2}{\abs{\vb*{r}_1 - \vb*{r}_2}} \expval*{\hat{\psi}^\dagger (\vb*{r}_1) \hat{\psi}^\dagger(\vb*{r}_2) \hat{\psi} (\vb*{r}_2) \hat{\psi}(\vb*{r}_1)} \\
        &= \frac{1}{2} \int \dd[3]{\vb*{r}_1} \int \dd[3]{\vb*{r}_2} \frac{e^2}{\abs{\vb*{r}_1 - \vb*{r}_2}} \\
        & \times \left( \expval*{\hat{\psi}^\dagger(\vb*{r}_2) \hat{\psi} (\vb*{r}_2)} \expval*{\hat{\psi}^\dagger(\vb*{r}_1) \hat{\psi} (\vb*{r}_1) - \expval*{\hat{\psi}^\dagger(\vb*{r}_2) \hat{\psi} (\vb*{r}_1)}} \expval*{\hat{\psi}^\dagger(\vb*{r}_1) \hat{\psi} (\vb*{r}_2)} \right),
    \end{aligned}
\]
如果电子比较定域%
\footnote{直觉上，电子比较定域意味着波函数会展现为一个个峰，似乎和平滑的电子密度的图景不相符，但在宏观上总是可以将电子密度粗粒化、平滑化，因此电子比较定域这件事不会破坏电荷平滑分布的经典图景。反之，真正会破坏经典图景的是不同电子的波函数发生交叠而导致交换能。}%
，那么在大尺度上关联函数$\expval*{\hat{\psi}^\dagger(\vb*{r}_1) \hat{\psi}(\vb*{r}_2)}$会快速衰减，于是就得到大尺度上的库伦能：
\begin{equation}
    \expval*{\hat{H}_\text{columbic}} = \frac{1}{2} \int \dd[3]{\vb*{r}_1} \int \dd[3]{\vb*{r}_2} \frac{e^2}{\abs{\vb*{r}_1 - \vb*{r}_2}} \expval*{\hat{n} (\vb*{r}_1)} \expval*{\hat{n} (\vb*{r}_2)}.
\end{equation}
这和经典的连续介质电动力学给出的结果完全一致。假定大尺度上$\expval*{\hat{\psi}^\dagger(\vb*{r}_1) \hat{\psi}(\vb*{r}_2)}$会快速衰减的近似称为\textbf{托马斯-费米近似}，这个近似的意义在于将系统的所有信息都使用电子数密度期望给出了，并且库伦能和经典理论完全一致。

假定体系\eqref{eq:electron-gas-hamiltonian-sq}的基态近似为
\begin{equation}
    \ket{\text{HF}} = \prod_\alpha \hat{c}_\alpha \ket{0},
    \label{eq:hatree-fock-ansatz}
\end{equation}
其中参与求和的$\hat{c}_\alpha$共有$n$个，$n$是事先给定的系统中的粒子数。
这个拟设等于是说，体系的基态和某个乘积态非常接近。
一般而言，不能够保证\eqref{eq:electron-gas-hamiltonian-sq}真的有形如\eqref{eq:hatree-fock-ansatz}的本征态，但是我们总是可以让\eqref{eq:hatree-fock-ansatz}的能量期望值取最小值，也即求解以下问题：
\begin{equation}
    \argmin_{\hat{\psi}} \mel{\text{HF}}{\hat{H}}{\text{HF}} \suchthat \text{$\hat{\psi}$ is a field operator}.
    \label{eq:minimize-energy}
\end{equation}
由于Hatree-Fock态是乘积态，可以使用Wick定理，并注意到依照定义有
\[
    \mel{0}{\hat{\psi}(\vb*{r})\hat{c}^\dagger_\alpha}{0} = \braket{\vb*{r}}{\phi_\alpha} = \phi_\alpha(\vb*{r}),
\]
$\phi_\alpha(\vb*{r})$为产生算符$\hat{c}^\dagger_\alpha$产生的粒子在坐标空间中的波函数，可以计算出
\[
    E_\text{HF} = \mel{\text{HF}}{\hat{H}}{\text{HF}} = 
\]
于是最优化问题\eqref{eq:minimize-energy}就变成一个约束优化问题：
\[
    \argmin_{\phi_\alpha(\vb*{r})} E_\text{HF} \suchthat \int \dd[3]{\vb*{r}} \abs{\phi_\alpha(\vb*{r})}^2 = 1, \quad \text{for all $\alpha$}.
\]

\subsection{离子实}

现在我们转而讨论晶格本身的运动。为了避免混淆使用大写字母表示关于离子实的物理量。使用

\section{理想晶体}

所谓晶体指的是一种在三个独立的空间方向上具有离散的平移不变性且并没有连续平移不变性的物体。\eqref{eq:many-body-hamiltonian}显然具有连续的平移不变性，因此晶体的形成必然经历了对称性自发破缺，且在较高的能量下原本的晶体一定会相变成某种更加均匀的东西。

本节讨论\textbf{理想晶体}，即非常大，以至于其表面的情况几乎不会影响内部电子运动的晶体。

\subsection{晶格的几何形状}

我们采取玻恩–奥本海默近似，将离子实看成一个背景，而忽略其中的自由度（既然这些自由度在价电子的物理过程的时间尺度上基本上不参加相互作用）。这样一来离散的平移不变性只应该来自$V(\vb*{r})$。
我们于是看到了形成晶体的对称性自发破缺的来源：低能下离子实自发地排成了比较规则的序列，从而虽然晶体服从的物理规律实际上确实是连续平移不变的，近似定律\eqref{eq:electron-gas-hamiltonian}却由于离子实排列成了空间重复的序列而只有离散平移不变性而没有连续平移不变性。
我们称这种离子实周期性排列形成的结构为\textbf{晶格}。

既然晶格具有空间周期性，只要知道了一个离子实的位置以及空间周期性的方向（晶体的空间指向）就可以知道所有离子实的位置。任意两个离子实之间的位置矢量形如
\begin{equation}
    \vb*{R}_n = n_1 \vb*{a}_1 + n_2 \vb*{a}_2 + n_3 \vb*{a}_3, \quad n = (n_1, n_2, n_3) \in \mathbb{N}^3.
\end{equation}
这些位置矢量构造了一架三维网格，这个网格称为\textbf{布拉维格子}，这些矢量称为\textbf{布拉维格矢}，$\{\vb*{a}_i\}$称为\textbf{晶格常数}，$n$称为\textbf{格点坐标}。

布拉维格子的\textbf{原胞}（也就是空间周期性结构的最小单位）有许多划分方法。可以以$\vb*{a}_1, \vb*{a}_2, \vb*{a}_3$张成的长方体为一个原胞，称为\textbf{初基原胞}。
另一种原胞是\textbf{维格纳-赛兹原胞}，它是空间中与某个特定格点的距离小于与任何其它格点的距离的点的轨迹，或者等价地说，它是某个特定格点与相邻格点的连线的垂直平分面包围出的立体。
维格纳-赛兹原胞的特别之处在于，任意一个空间矢量都可以写成维格纳-赛兹原胞中的一个矢量加上一个布拉维格矢，这可以使用非常直观的方式证明。

\subsubsection{晶格分类}

% TODO：群论

\subsubsection{倒格子}

有关晶体的所有可观察物理量均具有和布拉维格矢一样的对称性，也即，它们在三个方向上以$\vb*{a}_1,\vb*{a}_2,\vb*{a}_3$为周期。
回顾傅里叶级数的公式，我们有
\[
    f(x) = \frac{1}{T} \sum_{m=-\infty}^\infty \ee^{\ii \frac{2\pi m x}{T}} \left(\int \dd{t} f(t) \ee^{-\ii \frac{2\pi m t}{T}}\right) ,
\]
其三维形式就是
\[
    f(\vb*{r}) = \frac{1}{V} \sum_{m=-\infty}^\infty \ee^{\ii \vb*{G}_m \cdot \vb*{r}} \int_V \dd[3]{\vb*{r}'} f(\vb*{r}') \ee^{- \ii \vb*{G}_m \cdot \vb*{r}}, \quad \vb*{G}_m \cdot \vb*{a}_i = 2\pi N_i, \quad N_i \in \mathbb{N}.
\]
$\vb*{G}_m$满足的条件等价于，对任意的布拉维格矢都有
\begin{equation}
    \vb*{G}_m \cdot \vb*{R}_n = 2\pi N, \quad N \in \mathbb{N},
\end{equation}
这又等价于，
\begin{equation}
    \vb*{G}_m = G_1 \vb*{b}_1 + G_2 \vb*{b}_2 + G_3 \vb*{b}_3, \quad \vb*{a}_i \cdot \vb*{b}_j = 2 \pi \delta_{ij}.
\end{equation}
因此诸$\vb*{G}_m$也构成一个布拉维格子，我们称它为\textbf{倒格子}，与$\vb*{R}_n$构成的空间网格（称为\textbf{正格子}）相区分，同样，称$\vb*{r}$所在的三维空间为\textbf{实空间}，$\vb*{G}$所在的空间为\textbf{倒空间}。倒格子的基矢量和正格子的基矢量互为共轭基矢量。
两种格子的基矢量可以通过下式
\begin{equation}
    \frac{1}{2\pi} \vb*{b}_1 = \frac{\vb*{a}_2 \times \vb*{a}_3}{\vb*{a}_1 \cdot (\vb*{b}_2 \times \vb*{b}_3)}
\end{equation}
及其轮换相互换算。
在写出倒格子的显式表达式之后，晶体中的周期性量的傅里叶变换就是
\begin{equation}
    F(\vb*{r}) = \sum_{\vb*{g}} \tilde{F}(\vb*{g}) \ee^{\ii \vb*{g} \cdot \vb*{r}},
\end{equation}
其中$\vb*{g}$是布拉维格矢，且
\begin{equation}
    \tilde{F}(\vb*{g}) = \frac{1}{V} \int_V \dd[3]{\vb*{r}} F(\vb*{r}) \ee^{-\ii \vb*{g} \cdot \vb*{r}}.
\end{equation}

倒格子的维格纳-赛兹原胞称为\textbf{第一布里渊区}，相应的，某格点和它所有次近邻格点的垂直平分面包围成的区域称为\textbf{第二布里渊区}，等等。
显然，倒格子所在的整个动量空间可以被划分为不相交的一系列第一布里渊区。
引入第一布里渊区这个概念的原因在于它实际上是定义在正格子上的函数的傅里叶变换的动量取值范围。
使用$i=(i_1, i_2, i_3)$表示格点坐标，则
\begin{equation}
    \frac{1}{N} \sum_{\vb*{a}_i} \ee^{\ii (\vb*{k} - \vb*{k}') \cdot \vb*{a}_i} = \sum_{\vb*{g}} \delta(\vb*{k} - \vb*{k}' + \vb*{g}),
\end{equation}
其中$\vb*{a}_i$指的是$i$对应的位矢，$N$是晶格中总离子数，$\vb*{g}$扫过整个倒格子。$\delta(\vb*{k} - \vb*{k}')$实际上应该是离散$\delta$函数，但是为了和连续动量的情况保持一致我们还是使用这个记号。
可以看到方程右边是周期性的，如果限制$\vb*{k}$在第一布里渊区中，那么就有非常简单的形式：
\begin{equation}
    \frac{1}{N} \sum_{\vb*{a}_i} \ee^{\ii (\vb*{k} - \vb*{k}') \cdot \vb*{a}_i} = \delta(\vb*{k} - \vb*{k}'),
\end{equation}
从而得到与之对偶的
\[
    \frac{1}{N} \sum_{\vb*{k}} \ee^{\ii (\vb*{a}_i - \vb*{a}_j)} = \delta_{ij}.
\]
这又意味着第一布里渊区内的动量取值数目可以认为是$N$个，当然这是正确的，因为实空间中的$N$点离散信号做离散傅里叶变换之后会得到倒空间中的周期性离散信号，其周期正好是$N$，第一布里渊区正好是一个周期。

并非所有晶体中的物理量都是周期性的，它们的傅里叶变换中的动量不局限在倒格子上。

\subsubsection{有限大小的晶体}

晶格对电子的吸引比较明显，因此电子自发溢出晶格的概率并不大，从而可以将晶格表面看成一个势阱。
晶格表面的形状以及势阱的高度无疑会影响电子气的行为，但由于晶体非常大，这种影响对稍微远离表面的电子都是非常微弱的。（接近表面的电子可能参与表面态，此时关于晶体表面的信息就非常重要了）
因此我们认为晶体是长宽高各为$L$的大正方体，$L$相对电子、原子的尺度都是非常大的；同时我们简单地施加一个周期性边界条件来表示势阱的存在，即认为
\begin{equation}
    \psi(\vb*{r}) = \psi(\vb*{r} + L \vb*{e}_i), \quad i = 1, 2, 3.
    \label{eq:periodic-boundary}
\end{equation}
同时我们暂时忽略在晶体外找到电子的概率，因为它相对于在晶体内部找到电子的概率是非常小的。

由于晶体是有限大小的，$\vb*{k}$的取值是离散化的，因为波函数必须满足\eqref{eq:periodic-boundary}，为了尽可能让$u$容纳较多信息，我们用$\vb*{k}$来满足这个要求，即
\[
    \ee^{\ii \vb*{k} \cdot \vb*{r}} = \ee^{\ii \vb*{k} \cdot (\vb*{r} + L \vb*{e}_i)}, \quad i = 1, 2, 3,
\]
这样$\vb*{k}$的取值范围就是一个晶格常数为$2\pi / L$的三维点阵。%
\footnote{这个点阵不是倒格子：倒格子的晶格常数和实际的物理结构——也就是晶格的结构——有关，而此处的点阵的晶格常数完全是我们强加的，且总是趋于零，使得格点动量看起来几乎是连续的，因此可以被划分成连续的布里渊区，等等。
}%
这个三维点阵正是局限在晶体内部的任何函数做空间傅里叶变换得到的波矢的取值范围，且有如下归一化条件：
\begin{equation}
    \frac{1}{V} \int \dd[3]{\vb*{r}} \ee^{\ii (\vb*{k} - \vb*{k}') \cdot \vb*{r}} = \delta(\vb*{k} - \vb*{k}'),
\end{equation}
其中$\delta(\vb*{k} - \vb*{k}')$实际上应该是离散$\delta$函数，但是为了和连续动量的情况保持一致我们还是使用这个记号。

现在我们有三种动量空间：
\begin{itemize}
    \item 晶格常数为$2\pi / L$的三维点阵是被限制在边长为$L$的实空间方盒中的函数的傅里叶变换的动量取值范围；
    \item 倒格子是具有和晶格一样的周期性的函数的傅里叶变换的动量取值范围；
    \item 第一布里渊区是定义在正格子上的函数的傅里叶变换的动量取值范围。
\end{itemize}

\subsection{布洛赫电子和能带理论}

\subsubsection{布洛赫电子}

现在尝试求解理想晶体中的电子气。由于晶格具有离散平移不变性，\eqref{eq:electron-gas-hamiltonian}也具有（而且只有）离散平移不变性，从而波函数也具有这样的不变性。我们有
\[
    \psi(\vb*{r}+\vb*{R}_n) = \ee^{\ii \alpha} \psi(\vb*{r}).
\]
请注意波函数的对称性可以略微低于哈密顿量，只要由它计算出的物理量的对称性和哈密顿量一致就可以，因此我们加上了复数因子。由于平移运算构成群，且$n$是群参数，有
\[
    R_{n_1+n_2} = R(n_1) R(n_2),
\]
波函数的形式只能是
\begin{equation}
    \psi(\vb*{r}+\vb*{R}_n) = \ee^{\ii \vb*{k} \cdot \vb*{R}_n} \psi(\vb*{r})
    \label{eq:periodic-wavefunction}
\end{equation}
及其线性组合。因此\eqref{eq:periodic-wavefunction}构成晶体中电子气中单个电子的态空间的一组基，且$\vb*{k}$是一个好量子数，称为\textbf{格点动量}或者\textbf{准动量}。它的性质类似动量，但并不是动量。
$\vb*{k}$是坐标系无关的真正的矢量。\eqref{eq:periodic-wavefunction}又说明，我们可以设
\begin{equation}
    \psi_{\vb*{k}}(\vb*{r}) = \ee^{\ii \vb*{k} \cdot \vb*{r}} u_{\vb*{k}}(\vb*{r}), \quad u_{\vb*{k}}(\vb*{r}+\vb*{a}_i) = u_{\vb*{k}}(\vb*{r}), \quad i = 1, 2, 3.
    \label{eq:bloch-wavefunction}
\end{equation}
因此，晶体中的波函数是一个受到一个周期为$\vb*{a}_1,\vb*{a}_2, \vb*{a}_3$的振幅调制的平面波。
\eqref{eq:bloch-wavefunction}称为\textbf{布洛赫波函数}，处于这种状态的电子称为\textbf{布洛赫电子}。

由于指数函数的周期性，设$\vb*{G}$是一个任意的倒格子格矢，那么就有
\[
    \psi_{\vb*{k}}(\vb*{r}) = \psi_{\vb*{k}+\vb*{G}}(\vb*{r}).
\]
因此，没有必要让$\vb*{k}$取遍整个空间。由维格纳-赛兹原胞的性质，对任何一个$\vb*{k}$，都存在一个第一布里渊区内部的$\vb*{k}'$，使得
\[
    \psi_{\vb*{k}}(\vb*{r}) = \psi_{\vb*{k}'}(\vb*{r}).
\]
另一方面，第一布里渊区内部的矢量彼此的差值不可能达到一个倒格子格矢的大小，因此第一布里渊区内部的$\vb*{k}$不会导致重复的波函数。于是不失一般性地我们可以要求$\vb*{k}$在第一布里渊区内部。

\subsubsection{定态解，即布洛赫波函数}

波函数表达式\eqref{eq:bloch-wavefunction}没有时间演化，所以现在我们讨论布洛赫电子的动力学。即使使用了波恩-奥本海姆近似，\eqref{eq:electron-gas-hamiltonian}仍然要求把系统内所有的电子均考虑进去。
为了简便，我们采用平均场近似，将电子之间的相互作用使用一个平均场代替，从而只需讨论单电子的薛定谔方程。这通常是合理的，因为电子由于泡利不相容原理，彼此通常离得比较远。于是布洛赫电子的动力学等价于求解形如\eqref{eq:bloch-wavefunction}的波函数在某个势场下的束缚态解。将\eqref{eq:bloch-wavefunction}代入
\[
    -\frac{\laplacian}{2m_\text{e}} \psi(\vb*{r}) + V(\vb*{r}) \psi(\vb*{r}) = \epsilon \psi(\vb*{r}),
\]
得到
\begin{equation}
    \left( - \frac{(\grad+\vb*{k})^2}{2m_\text{e}} + V(\vb*{r}) \right) u_{\vb*{k}}(\vb*{r}) = \epsilon u_{\vb*{k}}(\vb*{r}).
    \label{eq:block-energy-problem}
\end{equation}
在$\vb*{k}$已知的情况下求解该本征值问题，可以得到一组$u$以及对应的$E$。由于先前要求$u(\vb*{r})$是周期函数，该本征值问题必定给出离散谱%
\footnote{还可以从另一个角度理解为什么会出现多条能带。自由电子的能谱是抛物线，既然是在晶体内，动量会被约束在第一布里渊区内部，抛物线穿过第一布里渊区边界而折返回来，这样反复和自我交叉。
现在加上相互作用，相互作用会抹去奇异性，从而交叉点退开，自我交叉的单一能带分离成一系列不相交的波浪线，这就得到了一系列不同的能带。}%
，也即，我们会获得一组$(\psi_{n \vb*{k}}, \epsilon_{n \vb*{k}})$，使得
\begin{equation}
    \left( - \frac{(\grad+\vb*{k})^2}{2m_\text{e}} + V(\vb*{r}) \right) u_{n \vb*{k}}(\vb*{r}) = \epsilon_{n \vb*{k}} u_{n \vb*{k}}(\vb*{r}).
\end{equation}
显然，$n$是另一个（离散的）好量子数。一旦$\vb*{k}$和$n$给定，布洛赫波函数及其时间演化就完全求解出来了，从而$\vb*{k}$和$n$是坐标空间中的布洛赫波函数的全部好量子数。我们称取不同$n$值的电子处于不同的\textbf{能带}上，$n$为能带标记。%
\footnote{注意到，能带的导出实际上并未用到太多晶体的性质（空间周期性等），因此非晶体很多时候也有能带。}%
能带中的电子在空间上非常不定域，它们实际上是一系列格点上的定域态叠加而成的结果。也可以这么理解这一点：写出一个格点上的哈密顿量之后为了计算能带能量肯定要做对角化，对角化得到的本征向量肯定是把一系列格点上的定域态都线性组合起来了。
总之，能带中的布洛赫电子常常称为\textbf{巡游电子}。

由于晶体近似在一个无限深势阱中，波函数在晶体边界处快速衰减为零。这就意味着$\vb*{k}$实际上是离散的。然而，由于晶体的尺度通常远大于原子的尺度，$\vb*{k}$近似可认为是连续的。于是可以写出函数
\[
    \epsilon = \epsilon_n(\vb*{k}),
\]
由于$\vb*{k}$加上任何一个倒格矢之后给出同样的布洛赫波函数，$E$相对于$\vb*{k}$应该具有周期性，那么它必定是有界的。
这就是“能带”这个名称的来源：穷举第一布里渊区内部的所有$\vb*{k}$，得到的所有能量组成一条有限宽的条带。

最后我们指定波函数的归一化方式。可以在积分号前面加上一个系数，即
\begin{equation}
    \frac{1}{V} \int \dd[3]{\vb*{r}} \psi_{n\vb*{k}}^*(\vb*{r}) \psi_{m\vb*{k}'}(\vb*{r}) = \delta_{mn} \delta(\vb*{k}-\vb*{k}'),
    \label{eq:bloch-is-basis}
\end{equation}
从而让简单的平面波$\exp(\ii \vb*{k} \cdot \vb*{r})$不需要乘上归一化因子就能够成为归一化本征态。
设$V_\text{u.c.}$是单个晶胞的大小，则
\[
    V = N V_\text{u.c.},
\]
从而可以得到% TODO：详细推导
\begin{equation}
    \frac{1}{V_\text{u.c.}} \int_\text{u.c.} \dd[3]{\vb*{r}} u_{m\vb*{k}}^*(\vb*{r}) u_{n\vb*{k}}(\vb*{r}) = \delta_{mn}.
\end{equation}
只需要求解出一组满足以上条件的$\{u_{n\vb*{k}}\}$，就得到了一组正交归一化波函数$\{\psi_{n\vb*{k}}\}$。

\eqref{eq:bloch-is-basis}意味着布洛赫波函数是正交归一化波函数且对应的积分测度为
\[
    \frac{1}{\sqrt{V}} \int \dd[3]{\vb*{r}},
\]
记$\hat{c}_{n\vb*{k}}^\dagger$为位于能带$n$、格点动量为$\vb*{k}$的布洛赫电子的产生算符，那么%
\footnote{其中的$1/\sqrt{V}$的因子是因为二次量子化场算符通常使用全空间的积分为内积的定义，在此定义下，归一化的波函数是$\psi_{n\vb*{k}} / \sqrt{V}$而不是$\psi_{n\vb*{k}}$。}%
\begin{equation}
    \hat{c}_{n \vb*{k}}^\dagger = \frac{1}{\sqrt{V}} \int \dd[3]{\vb*{r}} \psi_{n \vb*{k}}(\vb*{r}) \hat{\psi}^\dagger(\vb*{r}),
\end{equation}
就有二次量子化哈密顿量
\begin{equation}
    \hat{H} = \sum_{n, \vb*{k}} \epsilon_{n\vb*{k}} \hat{c}^\dagger_{n\vb*{k}} \hat{c}_{n\vb*{k}}.
\end{equation}
$\vb*{k}$的取值局限在第一布里渊区内部，作为对比，不考虑周期势的边长为$L$的正方体势阱中的电子的$\vb*{k}$可以取遍所有位于那个边长为$2\pi / L$的格点。
但实际上两者的自由度是一样的，因为我们还有$n$标记各个能带，也即，我们相当于把所有能带中的动量都移动到了第一布里渊区内部。
% TODO：自由布洛赫电子的哈密顿量是不是也和自由电子气差不多？？

\subsubsection{Wannier波函数}

布洛赫波函数是格点动量空间中的波函数，我们当然可以在坐标空间中讨论问题，对应的波函数基底称为\textbf{Wannier波函数}。两者之间差一个（离散傅里叶）变换。
定义在格点上的函数以第一布里渊区为动量空间。我们使用$i, j, \ldots$表示格点坐标，$m, n, \ldots$表示能带编号，$\vb*{r}_i$表示$i$处的格点的位矢，则
\[
    w_{ni}(\vb*{r}) \propto \sum_{\vb*{k}} \psi_{n\vb*{k}}(\vb*{r}) \ee^{- \ii \vb*{k} \cdot \vb*{r}_i},
\]
上式前面的归一化系数尚未选定。在归一化布洛赫波函数时我们使用了积分测度
\[
    \frac{1}{V} \int \dd[3]{\vb*{r}},
\]
从而导致归一化条件中出现了关于整块晶体的参数$V$。对布洛赫波函数这是合理的，因为它的好量子数是动量，因此是非常不定域的波函数，但Wannier波函数使用格点坐标标记，因此是非常定域的波包，因此我们希望Wannier波函数的归一化因子应该是一个常数而不包含任何关于系统大小的信息。
容易计算出
\[
    \frac{1}{V} \int \dd[3]{\vb*{r}} \frac{1}{N} \left( \sum_{\vb*{k}} \psi^*_{n\vb*{k}}(\vb*{r}) \ee^{\ii \vb*{k} \cdot \vb*{r}_i} \right) \left( \sum_{\vb*{k}} \psi_{m\vb*{k}}(\vb*{r}) \ee^{- \ii \vb*{k} \cdot \vb*{r}_j} \right) = \delta_{mn} \delta_{ij},
\]
取
\begin{equation}
    w_{ni}(\vb*{r}) = \frac{1}{N} \sum_{\vb*{k}} \psi_{n\vb*{k}}(\vb*{r}) \ee^{-\ii \vb*{k} \cdot \vb*{r}_i}, \quad \psi_{n\vb*{k}} = \sum_{\vb*{r}_i} \ee^{\ii \vb*{k} \cdot \vb*{r}_i} w_{ni}(\vb*{r}),
\end{equation}
这样归一化条件就是
\begin{equation}
    \frac{1}{V_\text{u.c.}} \int \dd[3]{\vb*{r}} \abs{w_{ni}(\vb*{r})}^2 = 1.
\end{equation}
归一化常数是一个局域的晶胞体积，符合我们的要求。

现在来分析Wannier波函数在实空间中的具体形状。考虑到$u_{n\vb*{k}}$的周期性，我们有
\[
    u_{n\vb*{k}} (\vb*{r}) = u_{n\vb*{k}} (\vb*{r} - \vb*{r}_i),
\]
于是
\begin{equation}
    w_{ni}(\vb*{r}) = \frac{1}{N} \sum_{\vb*{k}} u_{n\vb*{k}} (\vb*{r} - \vb*{r}_i) \ee^{\ii \vb*{k} (\vb*{r} - \vb*{r}_i)},
\end{equation}
这表明Wannier波函数实际上是$\vb*{r} - \vb*{r}_i$的函数，可以写成
\[
    w_{ni}(\vb*{r}) = w_{n}(\vb*{r} - \vb*{r}_i),
\]
这当然是正确的，因为晶格中绝对位置$\vb*{r}$并无意义。
在$\vb*{r}$远离$\vb*{r}_i$时，指数因子快速振荡，导致整个求和基本上为零，因此Wannier函数只在$\vb*{r}_i$附加有较明显的值，因此它定域在格点$\vb*{r}_i$附近。

同样，Wannier波函数既然是一组正交归一化基底，就可以定义对应的二次量子化算符，即
\begin{equation}
    \hat{c}^\dagger_{ni} = \frac{1}{\sqrt{V_\textbf{u.c.}}} \int \dd[3]{\vb*{r}} w_{ni}^*(\vb*{r}) \hat{\psi}^\dagger(\vb*{r}).
\end{equation}

总之，晶格中的电子的波函数可以以高度定域在格点附近的一组波函数为基底，并且以对应的格点为一个量子数。

\subsubsection{紧束缚模型}

对一对$\{mi, nj\}$的组合只求和一次，就得到
\begin{equation}
    \hat{H} = - \sum_{\{mi, nj\}} t_{mi, nj} \hat{c}_{mi}^\dagger \hat{c}_{nj} + \text{h.c.}.
\end{equation}

\begin{equation}
    \hat{H} = \sum_{n,i,m,i}
\end{equation}

\subsection{晶格和声子}

首先考虑做小幅运动的离子实，即取简谐近似，这样晶格实际上仍然可以看成一个自由系统，哈密顿量为
\begin{equation}
    \hat{H} = \sum_i \frac{\hat{P}_n^2}{2M} + 
\end{equation}
其中$i$指的是晶格坐标，也就是三元组$(n_1, n_2, n_3)$。

% TODO：声学声子和光学声子

可以看到，声子和电子的量子化是很不相同的。对电子，我们首先写出一个多体一次量子化哈密顿量，然后做二次量子化；而对声子，我们实际上把使用格点坐标标记的离子实位移和动量当成了场算符（离散的场），然后直接对这两个场算符做正则量子化。
换而言之，没有声子的一次量子化：定义声子时我们的理论就是二次量子化的。

\subsection{热力学性质}

\subsubsection{比热}

\section{线性响应}

本节讨论对晶体引入小的外界扰动会导致的结果。

\subsection{外加电荷}\label{sec:ext-charge}

\subsubsection{托马斯-费米静态屏蔽势}

想象我们在一个满足托马斯-费米近似的近独立电子气当中放入一个电荷。显然，异号电荷会移动到前者附近而产生一个屏蔽效应。
在电子气规模很大时（我们所研究的固体总是在热力学极限之下，因此这是成立的），屏蔽效应很强，这让外加电荷对电子气的扰动实际上局限在外加电荷的一个小邻域内。
不管怎么说求解外加电荷的影响就是求解以下自洽问题：
\begin{enumerate}
    \item 外加电荷导致外加电势能
    \begin{equation}
        \phi_\text{ext} = \frac{Q}{r},
    \end{equation}
    \item 外加电势与屏蔽电荷形成的电势$\var{\phi}$叠加，导致总的电势变化为
    \begin{equation}
        \phi_\text{eff} = \phi_\text{ext} + \var{\phi},
    \end{equation}
    \item 总电势变化$\phi_\text{eff}$导致了电荷密度变化$\var{n}$，电荷密度变化给出屏蔽电势$\var{\phi}$。
\end{enumerate}
自洽求解以上问题就可以确定所有物理量。

以上自洽求解步骤还需要一个方程：$V_\text{eff}$是怎么影响电荷密度的。
$V_\text{eff}$改变粒子排布的方式是这样的：单电子的能量$\epsilon_{\vb*{k}}$会由于$V_\text{eff}$的引入发生一个小的变化，且这个小的变化在不同位置通常是不一样的。
由于托马斯-费米近似成立，使用半经典模型，认为每个$\vb*{r}$位置附近的诸电子都可以认为是组成了一个正则系综，且$\vb*{k}$和$\vb*{r}$可以同时确定，于是
\[
    n(\vb*{r}) = \sum_{\vb*{k}, \sigma} \frac{1}{1 + \ee^{\beta (\epsilon_{\vb*{k}}(\vb*{r}) - \mu)}}, \quad \epsilon_{\vb*{k}}(\vb*{r}) = \epsilon_{\vb*{k}}^0 + V_\text{eff}(\vb*{r}),
\]
由于体系足够大，屏蔽作用让外加电荷的作用几乎是局域的，则$\var{n}(\vb*{r})$可以写成$V_\text{eff}(\vb*{r})$的函数而不涉及长程相互作用。
而由于外加电荷很小，可以采取线性近似，于是（第二个等号是因为费米-狄拉克分布的形式）
\[
    \var{n} = \dv{n}{V_\text{eff}} V_\text{eff} = \sum_{\vb*{k}} \pdv{n}{\epsilon_{\vb*{k}}} V_\text{eff} = - \pdv{n}{\mu} V_\text{eff},
\]
定义
\begin{equation}
    N(\mu' - \mu) = \pdv{n\big|_{\mu \to \mu'}}{\mu'},
\end{equation}
其中我们将$n$的表达式中的$\mu$换成了变量$\mu'$，而使用$\mu$表示实际系统的化学势。使用该记号，则
\begin{equation}
    \var{n}(\vb*{r}) = - N(0) V_\text{eff}(\vb*{r}).
    \label{eq:from-veff-to-varn}
\end{equation}
这就是从$V_\text{eff}$计算$\var{n}$的方法。通过$\var{n}$计算$\var{\phi}$的方程为泊松方程
\[
    - \laplacian \phi_\text{eff} = 4 \pi \left( Q \delta(\vb*{r}) - e \var{n}(\vb*{r}) \right),
\]
其中我们不失一般性地将外加电荷放在原点上。使用傅里叶变换并且使用$\var{n}$和$V_\text{eff}$之间的线性关系\eqref{eq:from-veff-to-varn}，可以得到
\[
    k^2 V_\text{eff}(\vb*{k}) = - 4\pi e Q - 4 \pi e^2 N(0) V_\text{eff}(\vb*{k}),
\]
解出$V_\text{eff}(\vb*{k})$并做傅里叶逆变换得到
\begin{equation}
    V_\text{eff}(\vb*{r}) = - \frac{eQ}{r} \ee^{- \kappa_\text{TF} r},
    \label{eq:thomas-fermi-potential}
\end{equation}
其中
\begin{equation}
    \kappa_\text{TF} = 4 \pi e^2 N(0).
\end{equation}
这个结果就是\textbf{托马斯-费米屏蔽}。

\subsubsection{动态屏蔽响应}

托马斯-费米屏蔽是静态的。现在考虑一般的近独立电子气的线性响应。外加电势导致如下的相互作用哈密顿量：
\[
    \hat{H}_\text{ext} = \int \dd[3]{\vb*{r}} \hat{n}(\vb*{r}, t) V_\text{ext} (\vb*{r}, t),
\]
则它对电子数密度的影响可以使用（各向同性不含时体系的）推迟格林函数
\[
    G^\text{ret}_{nn}(\vb*{r}-\vb*{r}', t-t') = - \ii \Theta(t-t') \expval*{\comm{\var{\hat{n}}(\vb*{r}, t)}{\var{\hat{n}}(\vb*{r}', t')}}
\]
描述，而响应就是%
\footnote{我们没有将$V_\text{ext}$写进$\hat{H}$中而是把它看成了外界扰动，这样电子气本身的哈密顿量仍然是空间平移不变的。}%
\begin{equation}
    \expval*{\var{\hat{n}}(\vb*{r}, t)} = \int \dd{t'} G^\text{ret}_{nn}(\vb*{r}-\vb*{r}', t-t') V_\text{ext}(\vb*{r}', t),
\end{equation}
在频域中就是
\begin{equation}
    \expval*{\var{\hat{n}}(\vb*{k}, \omega)} = G^\text{ret}_{nn}(\vb*{k}, \omega) V_\text{ext}(\vb*{k}, \omega).
    \label{eq:green-function-electro-shielding}
\end{equation}
当然，在系统的构成已知的情况下，可以直接计算出格林函数$G^\text{ret}_{nn}$，但是本节不这么处理问题。相反，我们希望通过静电屏蔽效应的一般讨论来得到$G^\text{ret}_{nn}$的一个近似表达式。

外加势场是怎么影响电荷分布的？同上一节的经典处理一样，自洽方程可以通过下面的方法给出。
\begin{enumerate}
    \item 外加电荷引入外加电势能，
    \item 外加电势能导致屏蔽电荷，屏蔽电荷导致总的电势能变化，
    \item 总的电势能变化可以反推出屏蔽电荷。
\end{enumerate}

粒子数的平均值近似为一个经典的数密度，% TODO：什么时候可以这么做。。。交换能怎么办？还是这里没有考虑
从而$\var{V}$可以使用泊松方程写成
\[
    - \laplacian \var{V}(\vb*{r}, t) = - 4\pi e^2 \expval*{\var{\hat{n}}(\vb*{r}, t)},
\]
也即
\begin{equation}
    k^2 \var{V}(\vb*{k}, \omega) = 4\pi e^2 \expval*{\var{\hat{n}}(\vb*{k}, \omega)}.
\end{equation}
于是第三步完成了。

第二步则要求写出由于我们讨论的是一般的近独立电子气，格林函数是不容易计算的。
为简化问题我们做\textbf{RPA（Random Phase Approximation）近似}%
\footnote{这个名称最早来自核物理，在那里它是通过对某个随机相位的求和得到的。}%
，即认为$\var{\hat{n}}$和$V_\text{eff}$之间的响应函数近似是自由电子的密度-密度格林函数，即
\begin{equation}
    \expval*{\var{\hat{n}}(\vb*{k}, \omega)} = G^\text{0, ret}_{nn} (\vb*{k}, \omega) V_\text{eff} (\vb*{k}, \omega).
    \label{eq:rpa-approximation}
\end{equation}
% 这个近似有意义的原因是？
% 无能隙的激发能够把特别奇异的相互作用屏蔽掉（RPA近似），从而让微扰展开收敛得非常快。如果担心RPA不对，只需要把对的部分加上做微扰就可以了
这样就得到自洽方程
\[
    V_\text{ext}(\vb*{k}, \omega) + \frac{4\pi e^2}{k^2} \expval*{\var{\hat{n}}(\vb*{k}, \omega)} = (G^\text{0, ret}_{nn} (\vb*{k}, \omega))^{-1} \expval*{\var{\hat{n}}(\vb*{k}, \omega)},
\]
从而
\begin{equation}
    G^\text{ret}_{nn}(\vb*{k}, \omega) = \frac{G^\text{0, ret}_{nn}(\vb*{k}, \omega)}{1 - \frac{4\pi e^2}{k^2} G^\text{0, ret}_{nn}(\vb*{k}, \omega)}.
\end{equation}

计算出自由电子的密度-密度格林函数之后问题就完全解决了。使用松原理论，
\[
    G_{nn}^\text{0, ret}(\vb*{r}-\vb*{r}', \tau-\tau') = \sum_{\sigma, \sigma'} G
\]
\[
    G_{nn}^\text{0, ret}(\vb*{q}, \ii \omega_n) = \sum_{\sigma} \sum_{\vb*{k}} \frac{1}{\beta} \sum_{\nu_n} G_\sigma(\vb*{q}, \ii \nu_n) G_\sigma(\vb*{k} + \vb*{q}, \ii (\omega_n + \nu_n))
\]
其中
\[
    \nu_n = \frac{\pi(2n+1)}{\beta}
\]
为费米子的松原频率。自由费米子的松原格林函数为

\subsubsection{等离子体和等离激元}

\subsection{单杂质与局域磁矩}

考虑一个无相互作用的体系，我们在其中引入一个杂质，并且假定该杂质能够将电子紧密地约束在其周围。
这样一来我们就有了两套能级：一套是原本的费米液体，还有一套是一个单独的能级，处于这个能级的电子被束缚在杂质周围。
需要使用晶格动量和自旋标记前者（仅考虑能量最低的能带），称为\textbf{巡游电子}，因为它的波函数是布洛赫波函数，并不定域；后者是定域的，只需要使用自旋即可标记后者，称为\textbf{d电子}（因为很多时候这个轨道是杂质的d轨道）。
前者和后者可以自然地转化，即两者之间有\textbf{杂化}，于是描述它们的模型就是以下\textbf{单杂质的Anderson模型}：
\begin{equation}
    \hat{H} = \sum_{\vb*{k}, \sigma} \epsilon_{\vb*{k}} \hat{c}_{\vb*{k}\sigma}^\dagger \hat{c}_{\vb*{k} \sigma} + \sum_\sigma \epsilon_\text{d} \hat{c}_{\text{d}\sigma}^\dagger \hat{c}_{\text{d} \sigma} + \sum_{\vb*{k}, \sigma} V_{\vb*{k} \text{d}} \hat{c}_{\vb*{k} \sigma}^\dagger \hat{c}_{\text{d} \sigma} + \text{h.c.} + U \hat{n}_{\text{d} \uparrow} \hat{n}_{\text{d} \downarrow}.
    \label{eq:impurity-anderson}
\end{equation}
不失一般性地认为$V_{\vb*{k} \text{d}}$都是实数，如果它不是实数，那总是可以通过重新定义$\hat{c}_{\vb*{k} \text{d}}$（乘上一个复数因子）来让它变成实数。
最后一项是因为同处于d能级的两个电子之间会有库伦排斥作用，这一项实际上是唯一的真正的相互作用，因为前三项都是二次型。请注意这一项具有自选旋转不变性，这也是合理的。

d电子的相互作用项意味着d轨道上出现两个电子会大大增大能量，如果费米面位于d轨道出现一个电子和d轨道出现两个电子的能量之间，那么巡游电子总会填充d轨道，而且填充一个电子，其结果就是产生杂质附近的局域磁矩。

\[
    \Delta E \propto \frac{1}{\tau} \propto \sum_{\vb*{k}} \abs{V_{\vb*{k} \text{d}}}^2 N(\epsilon_\text{d}).
\]

当$U \gg \epsilon_\text{d} \gg \Delta E$时，展宽、良定义的局域磁矩

当$U \gg \Delta E \gg \epsilon_\text{d}$时能级已经很不清楚，和费米海混合的电子

\subsubsection{平均场近似}

相互作用项为
\[
    U \hat{n}_{\text{d} \uparrow} \hat{n}_{\text{d} \downarrow} = U \hat{c}_{\text{d} \uparrow}^\dagger \hat{c}_{\text{d} \uparrow} \hat{c}^\dagger_{\text{d} \downarrow} \hat{c}_{\text{d} \downarrow},
\]
现在尝试应用平均场近似。考虑其平均值并假定系统处在一个近似自由的态上，从而应用Wick定理，有
\[
    \begin{aligned}
        \expval{U \hat{n}_{\text{d} \uparrow} \hat{n}_{\text{d} \downarrow}} &= U \expval*{\hat{c}_{\text{d} \uparrow}^\dagger \hat{c}_{\text{d} \uparrow} \hat{c}^\dagger_{\text{d} \downarrow} \hat{c}_{\text{d} \downarrow}} \\
        &= U ( \expval*{\hat{c}_{\text{d} \uparrow}^\dagger \hat{c}_{\text{d} \uparrow}} \expval*{\hat{c}_{\text{d} \downarrow}^\dagger \hat{c}_{\text{d} \downarrow}} + \expval*{\hat{c}_{\text{d} \uparrow}^\dagger \hat{c}_{\text{d} \downarrow}} \expval*{\hat{c}_{\text{d} \uparrow} \hat{c}^\dagger_{\text{d} \downarrow}} ),
    \end{aligned}
\]
第二项如果有非零值，$z$方向上的自旋旋转对称性就破缺了。
确实有这样的可能，就是系统基态有对称性自发破缺，但这里暂时假定没有这种情况。%
\footnote{我们也可以看到平均场近似总是倾向于高估系统的对称性破缺。}%
这样就有
\[
    \expval{U \hat{n}_{\text{d} \uparrow} \hat{n}_{\text{d} \downarrow}} = U \expval*{\hat{c}_{\text{d} \uparrow}^\dagger \hat{c}_{\text{d} \uparrow}} \expval*{\hat{c}_{\text{d} \downarrow}^\dagger \hat{c}_{\text{d} \downarrow}},
\]
这又告诉我们，我们有
\[
    \expval{U \hat{n}_{\text{d} \uparrow} \hat{n}_{\text{d} \downarrow}} = \expval{ U \hat{n}_{\text{d} \uparrow} \expval*{\hat{n}_{\text{d} \downarrow}} + U \expval*{\hat{n}_{\text{d} \uparrow}} \hat{n}_{\text{d} \downarrow} - U \expval*{\hat{n}_{\text{d} \uparrow}} \expval*{\hat{n}_{\text{d} \downarrow}} },
\]
那么如果相互作用哈密顿量适用平均场近似我们就有
\begin{equation}
    U \hat{n}_{\text{d} \uparrow} \hat{n}_{\text{d} \downarrow} \approx U \hat{n}_{\text{d} \uparrow} \expval*{\hat{n}_{\text{d} \downarrow}} + U \expval*{\hat{n}_{\text{d} \uparrow}} \hat{n}_{\text{d} \downarrow} - U \expval*{\hat{n}_{\text{d} \uparrow}} \expval*{\hat{n}_{\text{d} \downarrow}}.
\end{equation}
当然，这只是一种可能的平均场分解——没有理由认为这就是最理想的近似，但实际上使用变分计算可以确定这确实是最理想的近似。
忽略仅改变能量零点的常数项，得到平均场哈密顿量
\begin{equation}
    \hat{H}_\text{MF} = \sum_{\vb*{k}, \sigma} \epsilon_{\vb*{k}} \hat{c}_{\vb*{k}\sigma}^\dagger \hat{c}_{\vb*{k} \sigma} + \sum_\sigma \epsilon_\text{d} \hat{c}_{\text{d}\sigma}^\dagger \hat{c}_{\text{d} \sigma} + \sum_{\vb*{k}, \sigma} V_{\vb*{k} \text{d}} \hat{c}_{\vb*{k} \sigma}^\dagger \hat{c}_{\text{d} \sigma} + \text{h.c.} + U \hat{n}_{\text{d} \uparrow} \expval*{\hat{n}_{\text{d} \downarrow}} + U \expval*{\hat{n}_{\text{d} \uparrow}} \hat{n}_{\text{d} \downarrow}.
    \label{eq:anderson-mf}
\end{equation}
这是一个二次型哈密顿量。\eqref{eq:anderson-mf}含有不确定的平均场序参量$\expval*{\hat{n}_{\text{d} \uparrow}}$和$\expval*{\hat{n}_{\text{d} \downarrow}}$，但是可以将它们当成参数，求解出$\hat{n}_{\text{d} \uparrow}$和$\hat{n}_{\text{d} \downarrow}$之后回代，从而形成自洽方程。
这样求解出的$\expval*{\hat{n}_{\text{d} \uparrow}}$和$\expval*{\hat{n}_{\text{d} \downarrow}}$

求解\eqref{eq:anderson-mf}，在适当的条件上
% 但是这样还是破缺了自旋守恒。。那一开始的假设还是成立的吗？

可以对\eqref{eq:anderson-mf}做对角化。定义
\begin{equation}
    E_{\text{d} \sigma} = \epsilon_\text{d} + U \expval*{\hat{n}_{\text{d} (-\sigma)}},
\end{equation}
则
\begin{equation}
    \hat{H}_\text{MF} = \sum_{\vb*{k}, \sigma} \epsilon_{\vb*{k}} \hat{c}_{\vb*{k}\sigma}^\dagger \hat{c}_{\vb*{k} \sigma} + \sum_\sigma E_{\text{d} \sigma} \hat{c}_{\text{d}\sigma}^\dagger \hat{c}_{\text{d} \sigma} + \sum_{\vb*{k}, \sigma} V_{\vb*{k} \text{d}} \hat{c}_{\vb*{k} \sigma}^\dagger \hat{c}_{\text{d} \sigma} + \text{h.c.}
\end{equation}
可以直接使用成熟的矩阵方法来对角化这个哈密顿量。或者，采用下面的技巧：设已有对角化形式
\[
    \hat{H}_\text{MF} = \sum_{n, \sigma} \epsilon_{n \sigma} \hat{c}^\dagger_{n\sigma} \hat{c}_{n\sigma},
\]
其中$n$是某个未知的量子数。这样$\hat{c}_{n \sigma}$可以写成$\hat{c}_{\vb*{k} \sigma}$和$\hat{c}_{\text{d} \sigma}$的幺正变换，与此同时

\begin{equation}
    \begin{aligned}
        \epsilon_{n\sigma} \braket{\vb*{k}\sigma}{n \sigma} = \braket{\vb*{k} \sigma}{n \sigma} \epsilon_{\vb*{k}} + \braket{\text{d} \sigma}{n \sigma} V_{\vb*{k} \text{d}}, \\
        \epsilon_{n \sigma} \braket{\text{d} \sigma}{n \sigma} = \braket{\text{d} \sigma}{n \sigma} E_{\text{d} \sigma} + \sum_{\vb*{k}} \braket{\vb*{k} \sigma}{n \sigma} V_{\vb*{k} \sigma}.
    \end{aligned}
\end{equation}

\subsubsection{平均场近似下的格林函数}

由于系统自旋守恒，两个自旋不同的算符的格林函数为零，因此可以使用$G_{\text{dd}, \sigma}$标记d轨道电子的格林函数。
在$n$-$\sigma$表象下哈密顿量对角，于是使用$G_{n\sigma}$标记$n$表象电子的格林函数。
首先考虑松原格林函数，考虑到$n$表象下系统是自由的，有
\begin{equation}
    G_{n\sigma} (\omega_n) = \frac{1}{\ii \omega_n - \epsilon_n},
\end{equation}
请注意这里有两种$n$：$\omega_n$中的$n$标记频率，$\epsilon_n$和$G$的下标中的$n$则是量子数。
格林算符为
\begin{equation}
    \hat{G}(\omega_n) = \sum_{n, \sigma} \frac{\dyad{n\sigma}}{\ii \omega_n - \epsilon_n} = \frac{1}{\ii \omega_n - \hat{h}_\text{MF}},
\end{equation}
其中$\hat{h}_\text{MF}$就是单体哈密顿量，为
\begin{equation}
    \hat{h}_\text{MF} = \sum_{\vb*{k} \sigma} \epsilon_{\vb*{k}} \dyad{\vb*{k} \sigma} + \sum_\sigma E_{\text{d} \sigma} \dyad{\text{d} \sigma} + \sum_{\vb*{k}, \sigma} V_{\vb*{k} \text{d}} ( \ket{\vb*{k} \sigma} \bra{\text{d} \sigma} + \text{h.c.} ).
\end{equation}
由此可以计算出所有的格林函数。
格林算符的求解方式大致如下：我们有
\[
    (\ii \omega_n - \hat{h}_\text{MF}) \hat{G}(\omega_n) = 1,
\]
分别计算这个方程的不同矩阵元，可以得到
\begin{equation}
    (G_{\text{dd}, \sigma}(\omega_n))^{-1} = \ii \omega_n - E_{\text{d}\sigma} - \sum_{\vb*{k}} \frac{V_{\vb*{k}\text{d}}^2}{\ii \omega_n - \epsilon_{\vb*{k}}}.
\end{equation}
从以上松原格林函数可以容易地计算出推迟格林函数
\begin{equation}
    (G_{\text{dd}, \sigma}^\text{ret}(\omega))^{-1} = \omega - E_{\text{d}\sigma} - \sum_{\vb*{k}} \frac{V_{\vb*{k}\text{d}}^2}{\omega - \epsilon_{\vb*{k}} + \ii 0^+}.
\end{equation}
显然格林函数偏离了自由格林函数。自能为
\[
    \Sigma_{\text{d} \sigma} = \sum_{\vb*{k}} \frac{V_{\vb*{k}\text{d}}^2}{\omega - \epsilon_{\vb*{k}} + \ii 0^+}
\]
其虚部就是能级展宽的量级。可以把自能的实部归结到能级$E_{\text{d}\sigma}$中，因为后者是根本就不知道的。

\[
    A_{\text{d}\sigma} = \frac{1}{\pi} \frac{\Delta}{(\omega-E_{\text{d}\sigma})^2 + \Delta^2}
\]

\subsubsection{平均场自洽计算}

\subsubsection{Kondo效应}

在\eqref{eq:impurity-anderson}中$U > \abs{\epsilon_\text{d}} \gg V$时，d轨道上通常会有单个电子，从而导致一个局域磁矩。
我们使用平均场近似得到了一些定性的结果，本节则讨论在此基础上的涨落。平均场使用相互作用的平均值代替它本身，但是在这个平均值上还有热涨落和量子涨落。
$U > \abs{\epsilon_\text{d}}$意味着空的d轨道、半满的d轨道、全满的d轨道分得非常开，因此我们只讨论仅涉及单满的d轨道的一个低能有效模型，为此需要把空的d轨道、全满的d轨道这两个态积掉，而只保留低能子空间，即半满d轨道。

使用二阶微扰论处理这个问题，此时我们的任务是找到$\hat{H}$在二阶微扰下的本征值（本征矢并不重要）。如下将Anderson模型分成两部分：
\[
    \hat{H} = \underbrace{\sum_{\vb*{k}, \sigma} \epsilon_{\vb*{k}} \hat{c}_{\vb*{k}\sigma}^\dagger \hat{c}_{\vb*{k} \sigma} + \sum_\sigma \epsilon_\text{d} \hat{c}_{\text{d}\sigma}^\dagger \hat{c}_{\text{d} \sigma} + U \hat{n}_{\text{d} \uparrow} \hat{n}_{\text{d} \downarrow}}_{\hat{H}_0} + \underbrace{\sum_{\vb*{k}, \sigma} V_{\vb*{k} \text{d}} \hat{c}_{\vb*{k} \sigma}^\dagger \hat{c}_{\text{d} \sigma} + \text{h.c.}}_{\hat{H}_1}.
\]
$\hat{H}_0$中巡游电子和d电子是完全解耦的。
$\hat{H}_1$会让半满的d轨道变成全满，或者让半满的d轨道变成全空，因此其一阶效应对低能有效模型没有影响。
计算到二阶微扰，使用$n$标记高能的自由度，使用希腊字母标记低能自由度，有
\[
    \mel{\alpha}{\hat{H}_\text{eff}^{(2)}}{\beta} = \sum_n \mel{\alpha}{\hat{H}_1}{n} \mel{n}{\hat{H}_1}{\beta} \frac{1}{2} \left( \frac{1}{E_\alpha - E_n} + \frac{1}{E_\beta - E_n} \right),
\]
其中等式左边的$\ket{\alpha}$、$\ket{\beta}$是微扰之后的本征态，右边的$\ket{\alpha}$和$\ket{\beta}$是微扰之前的。
画费曼图可以得到两个初末态都在低能子空间中的二阶过程：%
\footnote{由于$\hat{H}_1$给出的都是二体散射，这是非连通图，但是由于这并不是在计算散射振幅，非连通图不能随意丢弃。}%
\begin{enumerate}
    \item 自旋为$\sigma'$的d电子转化为动量为$\vb*{k}'$的迅游电子（此时d轨道空了），然后动量为$\vb*{k}$，自旋为$\sigma$的巡游电子转化为d电子；
    \item 动量为$\vb*{k}'$，自旋为$\sigma'$的巡游电子转化为d电子（于是就有了两个d电子），自旋为$\sigma$的d电子转化为动量为$\vb*{k}$的巡游电子。
\end{enumerate}
实际上还有一些初末态完全一致的过程，但它们只会给哈密顿量加上一个常数，故略去。
过程1对应的哈密顿量为
\[
    \sum_{\vb*{k}, \vb*{k}', \sigma, \sigma'} V_{\vb*{k}' \text{d}} V^*_{\vb*{k} \text{d}} 
    \hat{c}_{\text{d} \sigma}^\dagger \hat{c}^\dagger_{\vb*{k}' \sigma'} 
    \frac{1}{2} \left( 
        \frac{1}{(\epsilon_{\vb*{k}} + \epsilon_\text{d}) - (\epsilon_{\vb*{k}} + \epsilon_{\vb*{k}'})} + \frac{1}{(\epsilon_{\vb*{k}'} + \epsilon_\text{d}) - (\epsilon_{\vb*{k}} + \epsilon_{\vb*{k}'})} 
    \right)
    \hat{c}_{\text{d} \sigma'} \hat{c}_{\vb*{k} \sigma} ,
\]
过程2对应的哈密顿量为
\[
    \sum_{\vb*{k}, \vb*{k}', \sigma, \sigma'} V_{\vb*{k} \text{d}} V_{\vb*{k}' \text{d}}^*
    \hat{c}^\dagger_{\text{d} \sigma'} \hat{c}^\dagger_{\vb*{k} \sigma}
    \frac{1}{2} \left(
        \frac{1}{(\epsilon_\text{d} + \epsilon_{\vb*{k}}) - (U + 2 \epsilon_{\text{d}})} + \frac{1}{(\epsilon_\text{d} + \epsilon_{\vb*{k}'}) - (U + 2 \epsilon_{\text{d}})}
    \right)
    \hat{c}_{\text{d} \sigma} \hat{c}_{\vb*{k}' \sigma'},
\]
于是最后有效哈密顿量为
\begin{equation}
    \begin{aligned}
        \hat{H}_\text{eff} &= \sum_{\vb*{k}, \sigma} \epsilon_{\vb*{k}} \hat{c}_{\vb*{k}\sigma}^\dagger \hat{c}_{\vb*{k} \sigma} + \sum_\sigma \epsilon_\text{d} \hat{c}_{\text{d}\sigma}^\dagger \hat{c}_{\text{d} \sigma} \\
        & + \sum_{\vb*{k}, \vb*{k}', \sigma, \sigma'} V_{\vb*{k}' \text{d}}^* V_{\vb*{k} \text{d}} \hat{c}^\dagger_{\vb*{k} \sigma} \hat{c}_{\vb*{k}' \sigma'} \hat{c}^\dagger_{\text{d} \sigma'} \hat{c}_{\text{d} \sigma} 
        \frac{1}{2} \left( \frac{1}{\epsilon_{\vb*{k} - \epsilon_\text{d}}} + \frac{1}{\epsilon_{\vb*{k}'} - \epsilon_\text{d}} + \frac{1}{U + \epsilon_\text{d} - \epsilon_{\vb*{k}}} + \frac{1}{U + \epsilon_\text{d} - \epsilon_{\vb*{k}'}} \right).
    \end{aligned}
    \label{eq:effective-anderson}
\end{equation}

\eqref{eq:effective-anderson}看起来非常复杂，但实际上通过对称性的论证可以发现它可以化简为非常简单的形式。
首先d轨道电子的自旋角动量显然是
\begin{equation}
    \hat{\vb*{S}}_\text{d} = \frac{1}{2} \hat{c}_{\text{d} \alpha}^\dagger \vb*{\sigma}_{\alpha \beta} \hat{c}_{\text{d} \beta},
\end{equation}
这里我们已经使用了爱因斯坦求和规则，$\alpha$和$\beta$标记了$\uparrow$和$\downarrow$两种自旋。


\section{集体行为和相变}

\subsection{一维电子系统的玻色化}

\subsubsection{费米点附近的有效理论}

考虑一个一维近独立电子系统。
一维系统的动量只有一个可能的方向。因此，一维系统的费米面无非是两个点。由对称性这两个点距离动量原点的位置是相同的。我们称它们为\textbf{费米点}。

考虑费米点附近的能量。使用巨正则系综并考虑扣除了化学势的有效哈密顿量，此时做线性近似，有
\begin{equation}
    \xi_{k} = \pm v_\text{F} (k - k_\text{F}).
\end{equation}
方程前面加正负号是因为色散关系是左右对称的，所以在两个费米点处的斜率互为相反数。
从费米面以下到费米面以上能量总是增加的，于是斜率为正表示$k>0$，斜率为负表示$k<0$。

我们将讨论费米点附近的低能有效理论，则晶格上的布洛赫产生湮灭算符中只有晶格动量集中在$\abs{k_\text{F}}$附近的部分是有意义的。
由于哈密顿量中不同动量的模式无耦合，可以直接弃去高动量模式，得到有效哈密顿量为
\[
    \hat{H}_\text{eff} = \sum_{\text{$k$ near $\pm k_\text{F}$}} \xi_k \hat{c}^\dagger_{k \sigma} \hat{c}_{k \sigma} = \sum_{\text{$k$ near $k_\text{F}$}} v_\text{F} (k - k_\text{F}) \hat{c}^\dagger_{k \sigma} \hat{c}_{k \sigma} - \sum_{\text{$k$ near $-k_\text{F}$}} v_\text{F} (k - k_\text{F}) \hat{c}^\dagger_{k \sigma} \hat{c}_{k \sigma}  ,
\]
为了简化，记
\begin{equation}
    p = \begin{cases}
        k - k_\text{F}, \quad k > 0, \\
        k_\text{F} - k, \quad k < 0,
    \end{cases}
\end{equation}
并使用$p$来标记布洛赫模式，则
\begin{equation}
    \hat{H}_\text{eff} = \sum_{\abs{p} < \Lambda} (v_\text{F} \abs{p} \hat{c}^\dagger_{ \text{L} p\sigma} \hat{c}_{\text{L} p\sigma} + v_\text{F} \abs{p} \hat{c}^\dagger_{ \text{R} p\sigma} \hat{c}_{\text{R} p\sigma}),
\end{equation}
其中$\Lambda$是一个截断参量，R和L分别表示对应的模式在$k>0$处（称为\textbf{右模式}），以及对应的模式在$k<0$处（称为\textbf{左模式}）。
在自由哈密顿量中不同自旋之间完全解耦，暂时只考虑一个自旋取值，于是
\begin{equation}
    \hat{H}_\text{eff} = \sum_{\abs{p} < \Lambda} (v_\text{F} p \hat{c}^\dagger_{\text{L} p} \hat{c}_{\text{L} p} + v_\text{F} p \hat{c}^\dagger_{\text{R} p} \hat{c}_{\text{R} p}).
    \label{eq:one-dimension-linear-model}
\end{equation}
若以$p$为动量，则$\hat{c}_{\text{R} p}$在坐标空间中对应着什么？容易发现，它对应的坐标空间中的湮灭算符正是$\hat{c}_{n\sigma}$以频率$\pm k_\text{F}$在空间上振荡的振幅，即
\begin{equation}
    \hat{c}_{n\sigma} = \ee^{\ii k_\text{F} na} \hat{c}_{\text{R} n \sigma } + \ee^{ - \ii k_\text{F} na} \hat{c}_{\text{L} n \sigma},
\end{equation}
它们在空间上是缓变的。% TODO：$\hat{\psi}_{\text{R}}(x)$？？

\subsubsection{玻色化}

首先考虑右模式的电子。
按照\eqref{eq:one-dimension-linear-model}，对一个能量本征态，将一个动量为$p$的右模式电子变为动量为$p+q$的右模式电子，则得到的结果仍然是一个能量本征态，且能量上升了$v_\text{F} q$。
而由于粒子数守恒，实际上任何一个能量本征态都可以通过“让费米海中的一些电子的动量增加”构造出来。这表明“将一个动量为$p$的右模式电子变为动量为$p+q$的右模式电子”是一个准粒子模式，其产生算符大体上如下：
\[
    \hat{b}_{\text{R} q}^\dagger \sim \sum_p \hat{c}^\dagger_{\text{R} (p+q)} \hat{c}_{\text{R} p} ,
\]
但是这样$p$可以取任何大的值，而低能有效理论\eqref{eq:one-dimension-linear-model}仅仅对比较小的$p$成立。
因此不出意外会产生一个发散的问题。例如，按照\eqref{eq:one-dimension-linear-model}费米海中实际上有无限多的电子，从而不受限制的对$p$求和会导致无穷大的结果。
可以在$\hat{b}_{\text{R} q}^\dagger$的表达式中引入一个截断，但是更好的做法实际上是使用正规排序。
设实空间的粒子数密度算符为
\[
    \hat{\rho}_\text{R}(x) = \hat{\psi}_\text{R}^\dagger(x) \hat{\psi}_\text{R}(x),
\]
它在动量空间的形式为%
\footnote{它不一定就是动量为$p$的粒子数。}%
\[
    \hat{\rho}_\text{R}(p) = \frac{1}{\sqrt{L}} \int \dd{x} \ee^{-\ii p x} \hat{\rho}_\text{R}(x) = \frac{1}{\sqrt{L}} \sum_k \hat{c}^\dagger_{\text{R} (k - p)} \hat{c}_{\text{R} k}.
\]
可以看到这个表达式和$\hat{b}^\dagger_{\text{R} p}$之间有线性关系，既然粒子数在没有截断时发散，$\hat{b}^\dagger_{\text{R} p}$必然也发散。
为了消除掉发散，重新定义粒子数密度算符为其原本的值的正规序：
\[
    \hat{\rho}_\text{R}(x) = \normalorder{\hat{\psi}_\text{R}^\dagger(x) \hat{\psi}_\text{R}(x)}, \quad \hat{\rho}_\text{R}(p) = \frac{1}{\sqrt{L}} \sum_k \normalorder{\hat{c}^\dagger_{\text{R} (k - p)} \hat{c}_{\text{R} k}}.
\]
计算对易关系得到
\[
    \comm*{\hat{\rho}_\text{R}(p)}{\hat{\rho}_\text{R}(p')} = - \frac{p}{2\pi} \delta_{pp'},
\]
这几乎就是一个玻色子对易关系了。缩放一下，定义
\[
    \hat{b}_{\text{R} p} = \sqrt{\frac{2\pi}{p}} \hat{\rho}_\text{R}(p), \quad \hat{b}^\dagger_{\text{R} p} = \sqrt{\frac{2\pi}{p}} \hat{\rho}_\text{R}(-p),
\]
就得到了正确的玻色子产生湮灭算符，它们描述的玻色子就是“将一个动量为$p$的右模式电子变为动量为$p+q$的右模式电子”这种模式。

现在我们需要反过来做正则量子化：在已经找到了一种粒子的产生湮灭算符之后，分析什么样的（定义在坐标空间中的）场能够产生这种粒子。
\[
    \hat{\phi}_\text{R}(p) = \frac{2\pi}{\ii p} \hat{\rho}_\text{R}(p),
\]
切换到坐标空间中就是
\[
    \hat{\rho}_\text{R}(x) = \frac{1}{2\pi} \grad \phi_\text{R}(x).
\]
我们写出场的傅里叶变换如下：
\[
    \phi_\text{R} (x) = \frac{1}{\sqrt{L}} \sum_p \ee^{- \alpha \abs{p} / 2} \phi_\text{R}(p) \ee^{\ii p x},
\]
这可以用来计算对易关系。

定义
\[
    \begin{bigcase}
        \hat{\phi}_\text{R} &= \hat{\phi} + \hat{\theta}, \\
        \hat{\phi}_\text{L} &= \hat{\phi} - \hat{\theta},
    \end{bigcase}
\]
通过$\hat{\rho}$的对易关系可以得到
\[
    \comm*{\hat{\phi}(x')}{\grad \hat{\theta}(x)} = -\ii \pi \delta(x' - x).
\]
中间其实还有很多对易关系？

写出
\[
    \hat{H} = v_\text{F} \sum_n p \hat{b}^\dagger_{\text{R} p} \hat{b}_{\text{R} p} + p \hat{b}^\dagger_{\text{L} p} \hat{b}_{\text{L} p}
\]
% TODO:这确实和\eqref{eq:one-dimension-linear-model}一致吗。。
\[
    H = \frac{v_\text{F}}{2\pi} \int \dd{x} (\grad{\phi})^2 + (\grad{\theta})^2
\]

有相互作用的体系经过玻色化之后也会得到同样的表达式
\[
    H = \frac{v_\text{F}}{2\pi} \int \dd{x} (\grad{\phi})^2 + (\grad{\theta})^2
\]

\[
    \hat{\psi}_\text{L} \sim \ee^{\ii \phi_\text{L}(x)}
\]

\subsection{Anderson局域化}

\subsection{超导}

% TODO：其实这里我是很迷惑的，什么时候需要考虑晶格对费米面形状的影响什么时候不需要？？

\subsubsection{交换声子导致的有效电子吸引相互作用}

电子-声子相互作用的顶角为一个电子入射，一个电子出射，产生/消灭一个声子。
现在积掉声子，则电子之间可以通过交换声子来产生一个四电子相互作用
\begin{equation}
    \hat{H}_{4\text{e}} = \frac{1}{2N} \sum_{\vb*{k}, \vb*{k}', \vb*{q}'} \sum_{\alpha, \beta} \abs{M_{\vb*{q}}}^2 \frac{\omega_{\vb*{q}}}{(\epsilon_{\vb*{k}} - \epsilon_{\vb*{k}+\vb*{q}})^2 - \omega_{\vb*{q}}^2} \hat{c}^\dagger_{(\vb*{k}+\vb*{q}) \alpha} \hat{c}^\dagger_{(\vb*{k}'-\vb*{q}) \beta} \hat{c}_{\vb*{k}' \beta} \hat{c}_{\vb*{k} \alpha},
    \label{eq:4-electron-interaction-by-phonon}
\end{equation}
其中$\omega_{\vb*{q}}$表示声子能量。任何更复杂的含有声子的费曼图都可以化归为二电子和声子的相互作用和一些电子相互作用的组合，因此\eqref{eq:4-electron-interaction-by-phonon}就给出了完整的没有声子的有效理论。
\eqref{eq:4-electron-interaction-by-phonon}本身是瞬时的，但请注意\eqref{eq:4-electron-interaction-by-phonon}含有电子能量差，这暗示它有可能实际上代表一个推迟相互作用。
当然，这是正确的，因为声子的传播需要时间。
另一方面，库伦势则没有推迟（当然这实际上做了近似，我们只不过不考虑相对论效应而已）。

现在考虑一个低能有效理论%
\footnote{这就是超导往往发生在低温下的原因：否则没法形成电子的有效吸引，四散排斥的电子会造成很大耗散。}%
，其中我们需要考虑的过程全部发生在费米面附近，入射电子和出射电子能量都接近于$\epsilon_\text{F}$。
费米面是球形的，通过几何关系可以看出$\vb*{k} + \vb*{k}' = 0$的过程是最重要的，此时发生相互作用前两个电子始终在费米面的两端，相互作用之后两个电子还是位于费米面的两端。
这样\eqref{eq:4-electron-interaction-by-phonon}就简化为
\begin{equation}
    \hat{H}_{4\text{e}} = \frac{1}{2N} \sum_{\vb*{k}, \vb*{q}'} \underbrace{\sum_{\alpha, \beta} \abs{M_{\vb*{q}}}^2 \frac{\omega_{\vb*{q}}}{(\epsilon_{\vb*{k}} - \epsilon_{\vb*{k}+\vb*{q}})^2 - \omega_{\vb*{q}}^2}}_{V(\vb*{q}, \epsilon_{\vb*{k}} - \epsilon_{\vb*{k}+\vb*{q}})} \hat{c}^\dagger_{(\vb*{k}+\vb*{q}) \alpha} \hat{c}^\dagger_{(-\vb*{k}-\vb*{q}) \beta} \hat{c}_{-\vb*{k} \beta} \hat{c}_{\vb*{k} \alpha}.
    \label{eq:low-energy-4-electron}
\end{equation}
由于电子能量差非常小，显然
\[
    V(\vb*{q}, \epsilon_{\vb*{k}} - \epsilon_{\vb*{k}+\vb*{q}}) = \abs{M_{\vb*{q}}}^2 \frac{\omega_{\vb*{q}}}{(\epsilon_{\vb*{k}} - \epsilon_{\vb*{k}+\vb*{q}})^2 - \omega_{\vb*{q}}^2} < 0,
\]
因此这个声子中介的相互作用是吸引相互作用。

库伦相互作用是排斥的，电-声子相互作用是吸引的；绝对强度显然是前者强。
然而，实际上库伦相互作用很容易被屏蔽，因为把低能电子看成外加电荷，那么高能电子就会来屏蔽它（见\autoref{sec:ext-charge}），因此把高能电子积掉之后得到的屏蔽库仑相互作用并不强，因此在重整化下，库仑相互作用实际上只是对电子能带的修正（这和费米液体的想法很相似：渐染地加入一个不大的相互作用仅仅会导致电子自能修正而已）。
另一方面，电-声子相互作用是不容易屏蔽的，实际上推迟相互作用就是不容易屏蔽的。
因此，\eqref{eq:low-energy-4-electron}在重整化之后是主要的电子间相互作用。

声子的频率只出现在0和德拜频率$\omega_\text{D}$之间，换而言之吸引相互作用只出现在
\[
    \omega = \abs{\epsilon_{\vb*{k}} - \epsilon_{\vb*{k}+\vb*{q}}} < \omega_\text{D}
\]
时。数值计算可以表明对超导现象而言最重要的是建立起电子之间的吸引相互作用，其具体形式并不重要，这样我们设
\begin{equation}
    V(\vb*{q}, \omega) = \begin{cases}
        - V_0, \quad \omega < \omega_\text{D}, \\
        0, \quad \omega > \omega_\text{D}
    \end{cases}.
\end{equation}
这样整个系统的哈密顿量就是
\begin{equation}
    \hat{H} = \sum_{\vb*{k}, \alpha} (\epsilon_{\vb*{k}} - \mu) \hat{c}_{\vb*{k} \alpha}^\dagger \hat{c}_{\vb*{k} \alpha} - V_0 \sum_{\vb*{k}, \vb*{k}', \vb*{q}} \sum_{\alpha, \beta} \hat{c}^\dagger_{(\vb*{k} + \vb*{q}) \alpha} \hat{c}^\dagger_{(\vb*{k}' - \vb*{q}) \beta} \hat{c}_{\vb*{k} \alpha} \hat{c}_{\vb*{k}' \beta}.
\end{equation}

\subsubsection{库伯对的平均场方法}

数值计算或者手算二体问题会发现可能出现\textbf{库伯对}，即一对位于费米面两端，自旋不相等的电子配对。
这种配对写成算符形式就是$\hat{c}^\dagger \hat{c}^\dagger$的形式，或者等价的$\hat{c} \hat{c}$形式。
如果其期望值不为零，那么$U(1)$对称性就破缺了，即电荷守恒对称性被破缺了。

于是库伯对序参量的一般形式显然是$\expval*{\hat{c}_{\vb*{k}\alpha}} \hat{c}_{\vb*{k}' \beta}$。
考虑
\[
    \expval*{\hat{c}_{\vb*{k} \alpha} \hat{c}_{- \vb*{k} \beta}}
\]


\[
    - \frac{(\grad - \ii e \vb*{A})^2}{4 m^*} \Phi
\]
\[
    \vb*{j} \propto \Phi^* \grad{\Phi}
\]

超导的电流来自序参量的梯度，这和通常导电的机制（电场下费米面发生移动）不同。由于序参量是复的，即使不存在振幅输运，仅仅靠不同点相位不同就足够产生持续电流。这是一个稳态解，所以不存在能量消耗


\[
    \epsilon_{\vb*{k} \uparrow} = \epsilon_{-\vb*{k} \downarrow}
\]
是因为时间反演对称性

\subsection{玻色-爱因斯坦凝聚}

\subsection{二维正方晶格的反铁磁长程序}

\subsubsection{二维正方晶格上的自旋}

费米子体系中可以有各种各样的密度波：自旋密度波、电荷密度波、超导配对密度波等。所谓密度波实际上就是一种长程序，它在空间中有一种周期性振荡，可以是相位的振荡也可以是大小的振荡。
也即，这样的长程序对应的序参量形如%
\footnote{请注意这个序参量实际上是一种二电子集体运动模式，即相邻的两个电子的自旋总是保持一上一下的这种运动模式。
这暗示我们，如果需要超越平均场近似的理论，只需要把这种模式定义成一个新的（玻色）场就可以。
这个技巧和一维电子系统的玻色化很相似。}%
\begin{equation}
    \Delta(\vb*{r}) \sim \Delta_0 \ee^{\ii \vb*{Q} \cdot \vb*{r}}.
\end{equation}
当然它还可以是实场，那就要加上复共轭。

现在考虑一个二维正方晶格，假定它可以有一个反铁磁相，也即，相邻格点的自旋倾向于变得反平行，或者说形成一个自旋密度波。
设系统的哈密顿量为
\begin{equation}
    \hat{H} = \sum_{\vb*{k}, \alpha} \xi_{\vb*{k}} \hat{c}_{\vb*{k} \alpha}^\dagger \hat{c}_{\vb*{k} \alpha} + J \sum_{\pair{i, j}} \hat{\vb*{S}}_i \cdot \hat{\vb*{S}}_j,
    \label{eq:2dim-square-spin}
\end{equation}
其中
\begin{equation}
    \hat{\vb*{S}}_i = \sum_{\alpha, \beta} \hat{c}^\dagger_{i \alpha} \vb*{\sigma}_{\alpha \beta} \hat{c}_{i \beta}
    \label{eq:spin-wave-order-parameter}
\end{equation}
为格点$i$的自旋矢量。设反铁磁序的序参量为$\vb*{\phi}$，一个不错的选择是
\begin{equation}
    \expval*{\hat{\vb*{S}}_i} = (-1)^i \vb*{\phi},
\end{equation}
这里的$(-1)^i$实际上是一种滥用记号：它实际上是
\[
    (-1)^i = (-1)^{i_x + i_y}
\]
的简写。为了方便起见，我们把$(i_x + i_y)$为奇数的格点的全体记为$A$，将$(i_x + i_y)$为偶数的格点的全体记为$B$，于是$A$中任何一个格点的近邻格点都在$B$中，反之亦然。
如果$\vb*{\phi}$非零，那么显然$\expval*{\hat{\vb*{S}}_i}$在$i \in A$时和$\expval*{\hat{\vb*{S}}_i}$在$i \in B$时差一个负号，即相邻的自旋一定是反向的，正好意味着形成了反铁磁序。

不失一般性地令晶格常数为1，则第一布里渊区为$[-\pi, \pi)^2$。在形成了一个完整的反铁磁序之后序参量$\Delta$的周期应该是两个格点，于是应有$\vb*{Q}=(\pi, \pi)$。

\subsubsection{平均场近似}

在\eqref{eq:2dim-square-spin}中做平均场近似
\begin{equation}
    \vb*{\hat{S}}_i \cdot \vb*{\hat{S}}_j = \expval*{\vb*{\hat{S}}_i} \cdot \vb*{\hat{S}}_j + \vb*{\hat{S}}_i \cdot \expval*{\vb*{\hat{S}}_j} - \expval*{\vb*{\hat{S}}_i} \cdot \expval*{\vb*{\hat{S}}_j},
\end{equation}
忽略平均场近似引入的常数项（我们这里不做自洽计算而只是分析相变点具有的性质），自旋相互作用项为
\[
    \begin{aligned}
        \hat{H}_\text{int} = J \sum_{\pair{i, j}} \hat{\vb*{S}}_i \cdot \hat{\vb*{S}}_j &\sim J \sum_{\pair{i, j}} (\expval*{\vb*{\hat{S}}_i} \cdot \vb*{\hat{S}}_j + \vb*{\hat{S}}_i \cdot \expval*{\vb*{\hat{S}}_j}) \\
        &= 2 J \sum_{\pair{i, j}} \expval*{\vb*{\hat{S}}_j} \cdot \vb*{\hat{S}}_i \\
        &= J \sum_i \sum_{j \in \text{nn of } i} \expval*{\vb*{\hat{S}}_j} \cdot \vb*{\hat{S}}_i,
    \end{aligned}
\]
其中nn表示“最近邻”，第二个等号中因子2消失了是因为$\pair{i, j}$对一对近邻只求和一次，而第三行中一对近邻实际上被求和了两次。
代入\eqref{eq:spin-wave-order-parameter}，注意到两个相邻格点的$(-1)^i$差一个负号，有
\[
    \begin{aligned}
        \hat{H}_\text{int} &= J \sum_i \sum_{j \in \text{nn of } i} (-1)^j \vb*{\phi} \cdot \vb*{\hat{S}}_i \\
        &= - J \sum_i (-1)^{i} \sum_{j \in \text{nn of } i} \vb*{\phi} \cdot \vb*{\hat{S}}_i,
    \end{aligned}
\]
由于系统具有自旋旋转不变性，不失一般性地要求$\vb*{\phi}$指向$z$轴，并设
\begin{equation}
    \Delta = 4 J \phi,
\end{equation}
则
\begin{equation}
    \hat{H}_\text{int} = - \sum_i (-1)^i \hat{S}_i^z \Delta = - \sum_i (-1)^i \Delta (\hat{c}_{i\uparrow}^\dagger \hat{c}_{i \uparrow} - \hat{c}_{i \downarrow}^\dagger \hat{c}_{i \downarrow}).
\end{equation}
设$\vb*{Q}=(\pi, \pi)$，则相互作用哈密顿量可以写成以下傅里叶变换的形式： 
\begin{equation}
    \hat{H}_\text{int} = - \sum_i \ee^{\ii \vb*{Q} \cdot \vb*{r}_i} \Delta (\hat{c}_{i\uparrow}^\dagger \hat{c}_{i \uparrow} - \hat{c}_{i \downarrow}^\dagger \hat{c}_{i \downarrow}) 
    = - \Delta \sum_{\vb*{k}} (\hat{c}_{(\vb*{k} + \vb*{Q})\uparrow}^\dagger \hat{c}_{\vb*{k} \uparrow} - \hat{c}_{(\vb*{k}+\vb*{Q}) \downarrow}^\dagger \hat{c}_{\vb*{k} \downarrow}).
\end{equation}
于是最后平均场哈密顿量就是
\begin{equation}
    \hat{H}_\text{MF} = \sum_{\vb*{k}, \alpha} (\xi_{\vb*{k}} \hat{c}_{\vb*{k} \alpha}^\dagger \hat{c}_{\vb*{k} \alpha} - \alpha \Delta \hat{c}_{(\vb*{k} + \vb*{Q}) \alpha}^\dagger \hat{c}_{\vb*{k} \alpha}).
    \label{eq:2dim-square-spin-mf}
\end{equation}
这里指定$\uparrow$对应$1$，$\downarrow$对应$-1$，虽然电子的自旋为$\pm 1/2$而不是$\pm 1$。
\eqref{eq:2dim-square-spin-mf}两边乘上2，并注意对$\vb*{k}$求和等价于对$\vb*{k}+Q$求和，且$\vb*{k}$等价于$\vb*{k}+2\vb*{Q}$，\eqref{eq:2dim-square-spin-mf}给出的能谱等价于以下矩阵
\[
    \pmqty{\xi_{\vb*{k}} & - \alpha \Delta \\ - \alpha \Delta & \xi_{\vb*{k} + \vb*{Q}}}
\]
的本征值，也就是
\begin{equation}
    E_{\vb*{k}} = \frac{\xi_{\vb*{k}} + \xi_{\vb*{k} + \vb*{Q}}}{2} \pm \sqrt{\frac{(\xi_{\vb*{k}} - \xi_{\vb*{k}+\vb*{Q}})^2}{4} + \alpha^2 \Delta^2}.
\end{equation}
这样可以得到两条能带，在$\Delta$为零时它们可以交叉，在$\Delta$不为零时能带交叉的部位就打开了一个能隙。

\subsubsection{“热点”和它附近的低能有效理论}

\eqref{eq:2dim-square-spin-mf}是\eqref{eq:2dim-square-spin}在反铁磁序相的一个有效理论。反铁磁序破缺了晶格上的平移不变性，因为反铁磁序状态中每个晶格和临近的晶格的自旋差一个负号。
反铁磁序还保留了一部分平移不变性：子格点$A$和$B$上仍有平移不变性，这两个子格点对应的倒格矢都是$\vb*{Q}$。
这样，\eqref{eq:2dim-square-spin-mf}的第一布里渊区是
\[
    \abs{k_x} + \abs{k_y} \leq \pi,
\]
这是\eqref{eq:2dim-square-spin}的第一布里渊区折叠之后得到的。
布里渊区变小当然是因为原胞变大了——从单个格点变成了一个$A$格点加上一个$B$格点。

% TODO
布里渊区折叠了，费米面交叉处打开能隙，形成一系列小费米pocket。热点附近的$\vb*{k}$和$\vb*{k} + \vb*{Q}$都在热点附近。

接下来讨论在热点附近的低能有效理论。\eqref{eq:2dim-square-spin}中的相互作用项是一个电子和一个自旋波模式（这是玻色子）发生散射，得到另一个电子，%
\footnote{自旋波模式是高能电子被积掉之后得到的，和低能费米子是两群不同的电子。}%
因此低能有效理论的散射项形如
\[
    \hat{\phi}_{\vb*{q}} \hat{c}^\dagger_{\vb*{k}+\vb*{q}\sigma} \hat{c}_{\vb*{k}\sigma'},
\]
由于是低能有效理论，我们认为形成了一个基本上稳定的反铁磁序，于是$\vb*{q}$接近$\vb*{Q}$，而电子能量$\epsilon_{\vb*{k}}$和$\epsilon_{\vb*{k}+\vb*{q}}$都在费米面附近。
这些条件只有在热点附近才能达到。
当然由于热点是费米面交叠之后打开能隙的位置，在这附近有低能有效理论是非常合理的。
这样，一个散射过程涉及两个热点。分别用1和2标记两个热点，记它们的动量为$\vb*{K}_1$和$\vb*{K}_2$，则有
\[
    \vb*{K}_2 = \vb*{K}_1 + \vb*{Q},
\]
并重新定义$\vb*{q}$和$\vb*{k}$为它们偏离$\vb*{Q}$和$\vb*{K}_1$的大小。这样，相互作用哈密顿量就是
\[
    \hat{\vb*{\phi}}_{\vb*{q}} \cdot (\sum_{\alpha, \beta} \hat{c}^\dagger_{1(\vb*{k} + \vb*{q})\alpha} \vb*{\sigma}_{\alpha \beta} \hat{c}_{2\vb*{k} \beta} + \text{h.c.}),
\]
完整的有效理论的哈密顿量为
\begin{equation}
    \hat{H}_\text{eff} = \sum_{\vb*{k}, \sigma} (\xi_{1\vb*{k}} \hat{c}^\dagger_{1\vb*{k} \sigma} \hat{c}_{1 \vb*{k} \sigma} + \xi_{2\vb*{k}} \hat{c}^\dagger_{2\vb*{k} \sigma} \hat{c}_{2 \vb*{k} \sigma}) + \hat{H}[\vb*{\phi}] + \lambda \sum_{\vb*{q}} \hat{\vb*{\phi}}_{\vb*{q}} \cdot (\sum_{\alpha, \beta} \hat{c}^\dagger_{1(\vb*{k} + \vb*{q})\alpha} \vb*{\sigma}_{\alpha \beta} \hat{c}_{2\vb*{k} \beta} + \text{h.c.}).
    \label{eq:2dim-square-spin-eff}
\end{equation}
上式中没有明确提玻色场——也就是自旋波场——的自由哈密顿量。这个自由哈密顿量通常是通过对称性分析得出的。
% TODO：为什么没有涉及别的场？一维电子气体的玻色化就涉及两个场

\[
    \xi_{\vb*{k}} = \vb*{v}_1 \cdot \vb*{k}
\]

\subsubsection{朗道阻尼}

现在我们尝试把电子完全积掉，只留下玻色型的自旋波模式。需要指出的是这个操作并不总是可行的：由于自旋波模式和电子都是低能自由度，简单地积掉其中一个自由度可能不能得到一个良定义的有效理论。
实际上，对二维体系的确会有这种棘手的细节。
下面的操作都是在默认确实可以积掉电子的前提下进行的。

从\eqref{eq:2dim-square-spin-eff}可以看出，一个自旋波模式可以衰变成一对电子空穴对，或者说一个自旋波模式可以将动量转移给一个电子而得到另一个电子，而自身湮灭。
因此自旋波模式是有有限的寿命的。由费米黄金法则，
\[
    \frac{1}{\tau} \sim \lambda^2 \int 
\]
总之最后自旋波模式的寿命为
\begin{equation}
    \frac{1}{\tau} \sim \frac{\lambda^2}{\abs{\vb*{p}_1 \times \vb*{p}_2}} \omega = \gamma \omega.
\end{equation}
衰变几率会直接反映在$\vb*{\phi}$的格林函数——从而有效作用量——中。
\[
    G_{\vb*{\phi}}^{-1} = \ii \gamma \abs{\omega} + \cdots = \ii  \gamma \sgn(\omega) \omega,
\]
第二个等号是为了正确的解析延拓。这就意味着自旋波模式的有效热力学作用量为
\[
    S_\text{eff} = \sum_{\vb*{q}, \omega_n} \vb*{\phi}(-\vb*{q}, -\omega_n) (\gamma \abs{\omega_n} + \omega_n^2 + a \vb*{q}^2 + \cdots) \vb*{\phi}(\vb*{q}, \omega_n), 
\]
$\omega_n^2$项和$\vb*{k}^2$项可以容易地切换到实空间，它们分别对应着时间导数平方项$(\partial_\tau \phi)^2$和梯度平方项$(\grad{\phi})^2$，但$\abs{\omega_n}$在实空间中没有简单的形式。

\subsubsection{Hertz理论}

最后我们讨论上一节得到的低能有效理论的

\end{document}